const u=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const y=window.enmity.modules.common.Toasts,R=window.enmity.modules.common.Dialog;window.enmity.modules.common.Token;const le=window.enmity.modules.common.REST;window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const I=window.enmity.modules.common.Navigation,ce=window.enmity.modules.common.NavigationNative,j=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme;const F=window.enmity.modules.common.Linking,B=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;function ae(e){window.enmity.plugins.registerPlugin(e)}function de(e){return window.enmity.plugins.getPlugin(e)}const L={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,o)=>window.enmity.modules.filters.byName(e,o),byTypeName:(e,o)=>window.enmity.modules.filters.byTypeName(e,o),byDisplayName:(e,o)=>window.enmity.modules.filters.byDisplayName(e,o)};function me(e,o){return window.enmity.modules.getModule(e,o)}function z(...e){return window.enmity.modules.bulk(...e)}window.enmity.modules.common;const{components:n}=window.enmity;n.Alert;const V=n.Button;n.FlatList;const K=n.Image;n.ImageBackground,n.KeyboardAvoidingView,n.Modal,n.Pressable,n.RefreshControl;const ue=n.ScrollView;n.SectionList,n.StatusBar,n.StyleSheet,n.Switch;const T=n.Text;n.TextInput,n.TouchableHighlight;const ge=n.TouchableOpacity;n.TouchableWithoutFeedback,n.Touchable;const f=n.View;n.VirtualizedList,n.Form,n.FormArrow,n.FormCTA,n.FormCTAButton,n.FormCardSection,n.FormCheckbox,n.FormDivider,n.FormHint,n.FormIcon,n.FormInput,n.FormLabel,n.FormRadio;const l=n.FormRow,W=n.FormSection;n.FormSelect,n.FormSubLabel;const A=n.FormSwitch;n.FormTernaryCheckBox,n.FormText,n.FormTextColors,n.FormTextSizes;function v(e,o,r){window.enmity.settings.set(e,o,r)}function d(e,o,r){return window.enmity.settings.get(e,o,r)}function he(e){return window.enmity.patcher.create(e)}function c(e){return window.enmity.assets.getIDByName(e)}function O(e,o,r){return window.enmity.utilities.findInReactTree(e,o,r)}function we(e,o,r){return window.enmity.utilities.findInTree(e,o,r)}var _="K2geLocker",ye="1.1.2",fe="Lock the specific server with passcode.",be=[{name:"mafu",id:"519760564755365888"}],Se={name:_,version:ye,description:fe,authors:be};function G(e,o){let r="";for(let g=0;g<e.length;g++)r+=String.fromCharCode(e.charCodeAt(g)^o.charCodeAt(g%o.length));return r}const ve=me(e=>e._dispatcher._actionHandlers._dependencyGraph.nodes.ID_7.name==="AppStateStore"),ke=ve._dispatcher._actionHandlers._dependencyGraph.nodes;function Ee(e){let o=we(ke,r=>r.name===e);if(o)return o.actionHandler}const{native:M}=window.enmity;function q(){M.reload()}M.version,M.build,M.device,M.version;const _e="https://github.com/m4fn3/K2geLocker",pe="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/manifest.json",Re="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/dist/K2geLocker.js";function Ie(e,o){window.enmity.plugins.installPlugin(Re,()=>{R.show({title:"K2geLocker",body:`Updated from ${e} to ${o}!
Do you want to reload Discord now?`,confirmText:"Yes",cancelText:"Later",onConfirm:()=>q()})})}function J(e=!1){le.get(pe).then(o=>{const r=JSON.parse(o.text),g=de(r.name);r.version.localeCompare(g.version,void 0,{numeric:!0})===1?(e||!e&&d(_,"ignored")!=r.version)&&R.show({title:"K2geLocker",body:`New version v${r.version} is available!`,confirmText:"Update",cancelText:"Ignore",onConfirm:()=>{v(_,"updating",!0),Ie(g.version,r.version)},onCancel:()=>v(_,"ignored",r.version)}):e&&R.show({title:"K2geLocker",body:`You are using latest version v${g.version}!`,confirmText:"OK"})}).catch(o=>{o.status===404&&R.show({title:"K2geLocker",body:"Failed to check for updates. Please check GitHub manually.",confirmText:"GitHub",cancelText:"Close",onConfirm:()=>F.openURL(_e)})})}const Q=j.createStackNavigator(),[Le]=z(L.byProps("AppState")),C="Love K2ge3 lol";c("nsfw_gate_lock");const X=c("img_nitro_star");c("ic_following");const Te=c("ic_info_24px"),Z=c("Small"),Ce=c("ic_arrow_back_24px"),x=B.createThemedStyleSheet({container:{backgroundColor:u.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:u.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:u.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:u.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:u.ThemeColorMap.HEADER_PRIMARY},close:{color:u.ThemeColorMap.HEADER_PRIMARY}});function $({callback:e=null,isSetup:o=!1,showClose:r=!0}){const g=Le.useWindowDimensions().width,D=Math.min(g,450);function N(){const i=B.createThemedStyleSheet({container:{flex:1,backgroundColor:u.ThemeColorMap.BACKGROUND_PRIMARY,alignSelf:"center",alignItems:"center",justifyContent:"center",width:D},title:{height:40},titleText:{color:u.ThemeColorMap.HEADER_PRIMARY,fontSize:30},circleBox:{flexDirection:"row",height:130,paddingTop:20},white_circle:{width:20,height:20,borderRadius:10,backgroundColor:"white",marginRight:10},gray_circle:{width:20,height:20,borderRadius:10,backgroundColor:"gray",marginRight:10},numberBox:{flexDirection:"row",flexWrap:"wrap",width:300},number:{width:100,height:70,alignItems:"center",justifyContent:"center"},numberText:{color:u.ThemeColorMap.HEADER_PRIMARY,fontSize:30}}),[w,k]=t.useState(""),[b,h]=t.useState(""),a=[i.gray_circle,i.gray_circle,i.gray_circle,i.gray_circle],[s,m]=t.useState(a);return t.createElement(f,{style:i.container},t.createElement(f,{style:i.title},t.createElement(T,{style:i.titleText},"Enter passcode")),t.createElement(f,{style:i.circleBox},t.createElement(f,{style:s[0]}),t.createElement(f,{style:s[1]}),t.createElement(f,{style:s[2]}),t.createElement(f,{style:s[3]})),t.createElement(f,{style:i.numberBox},[1,2,3,4,5,6,7,8,9,"",0,"back"].map((S,H)=>S!==""?t.createElement(ge,{style:i.number,key:H,onPress:()=>{if(typeof S=="number"){let E=b+S.toString();h(E);let P=s;P[E.length-1]=i.white_circle,m(P),E.length===4&&setTimeout(()=>{if(!o)E===G(d(_,"passcode"),`${C[5]}${C[6]}${C[0]}`)?(I.pop(),e(),y.open({content:"Successfully unlocked!",source:X})):(h(""),m(a),y.open({content:"Incorrect password. Try again.",source:Z}));else if(!w)k(E),h(""),m(a),y.open({content:"Retype new passcode to confirm.",source:Te});else{if(w===E){let se=G(w,`${C[5]}${C[6]}${C[0]}`);v(_,"passcode",se),y.open({content:"Successfully set new passcode!",source:X})}else y.open({content:"Passcode didn't match.",source:Z});I.pop()}},200)}else{let E=b.slice(0,-1);h(E);let P=s;P[E.length]=i.gray_circle,m(P)}}},typeof S=="number"?t.createElement(T,{style:i.numberText},S):t.createElement(K,{source:Ce})):t.createElement(f,{style:i.number,key:H}))))}return t.createElement(ce.NavigationContainer,null,t.createElement(Q.Navigator,{initialRouteName:"K2geLocker",style:x.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:x.cardStyle,headerStyle:x.header,headerTitleContainerStyle:x.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},t.createElement(Q.Screen,{name:"K2geLocker",component:N,options:{headerTitleStyle:{color:"white"},headerLeft:()=>{if(r)return t.createElement(V,{color:x.close.color,title:"Close",onPress:()=>I.pop()})},...j.TransitionPresets.ModalSlideFromBottomIOS}})))}c("img_nitro_star");const Pe=c("Small"),Me=c("img_account_sync_github_white"),xe=c("img_account_sync_twitter_white"),Ne=c("ic_message_retry"),Be=c("hub-invite"),De=c("ic_lock"),Fe=c("toast_image_saved"),Ke=c("ic_drag_icon_24px");var Ae=({settings:e})=>{const o=B.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:u.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:u.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"}});return t.createElement(ue,null,t.createElement(f,{style:o.container},t.createElement(K,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:o.image}),t.createElement(f,{style:o.title},t.createElement(T,{style:o.name},"K2geLocker"),t.createElement(T,{style:o.author},"by mafu"))),t.createElement(W,{title:"SETTINGS"},t.createElement(l,{label:"Setup Passcode",trailing:l.Arrow,leading:t.createElement(l.Icon,{source:Ke}),subLabel:"Open password setup modal",onPress:()=>{I.push($,{isSetup:!0})}}),t.createElement(l,{label:"Reload Discord",trailing:l.Arrow,leading:t.createElement(l.Icon,{source:Ne}),subLabel:"Reloading is required in order to properly initialize K2geLocker after enabling plugin",onPress:()=>{q()}}),t.createElement(l,{label:"Enable invitation menu hijacking",subLabel:"Useful for iPad on which can't long press icon. For servers with inv disabled, use /lock command.",leading:t.createElement(l.Icon,{source:Be}),trailing:t.createElement(A,{value:e.getBoolean("inv_hijack",!0),onValueChange:r=>{e.set("inv_hijack",r)}})}),t.createElement(l,{label:"Erase Passcode [TEST]",trailing:l.Arrow,onPress:()=>{e.set("passcode",void 0)}}),t.createElement(l,{label:"Fuck Passcode [TEST]",trailing:l.Arrow,onPress:()=>{e.set("passcode","k1odd;")}}),t.createElement(l,{label:"Enable app-wide locking",subLabel:"You can lock entire app with passcode!",leading:t.createElement(l.Icon,{source:De}),trailing:t.createElement(A,{value:e.getBoolean("lock_app",!1),onValueChange:r=>{r&&e.get("passcode")===void 0?(y.open({content:"Please set passcode in plugin setting first!",source:Pe}),r=!1):e.set("lock_app",r)}})}),t.createElement(l,{label:"Check for updates",subLabel:"Whether automatically check or not. You can tap here to check manually too.",leading:t.createElement(l.Icon,{source:Fe}),trailing:t.createElement(A,{value:e.getBoolean("check_updates",!0),onValueChange:r=>{e.set("check_updates",r)}}),onPress:()=>{J(!0)}})),t.createElement(W,{title:"INFORMATION"},t.createElement(l,{label:"GitHub (m4fn3)",style:o.info,trailing:l.Arrow,leading:t.createElement(l.Icon,{source:Me}),onPress:()=>{F.openURL("https://github.com/m4fn3/K2geLocker")}}),t.createElement(l,{label:"Twitter @m4fn3",style:o.info,trailing:l.Arrow,leading:t.createElement(l.Icon,{source:xe}),onPress:()=>{F.openURL("https://twitter.com/m4fn3")}})))},ee;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(ee||(ee={}));var U;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(U||(U={}));var te;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(te||(te={}));var oe;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(oe||(oe={}));var ne;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number",e[e.Attachment=11]="Attachment"})(ne||(ne={}));var re;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(re||(re={}));const Ge=c("img_nitro_star"),$e=c("Small"),Ue={id:"lock",name:"lock",displayName:"lock",description:"Lock the server with passcode",displayDescription:"Lock the server with passcode",type:U.Chat,execute:async function(e,o){d(_,"passcode")===void 0?y.open({content:"Please set passcode in plugin setting before you lock the server!",source:$e}):(v(_,o.guild.id,!0),y.open({content:"Successfully locked!",source:Ge}))}},p=he("K2geLocker"),[Ye,He,je,ze,Ve]=z(L.byName("MessagesConnected",!1),L.byProps("openLazy","hideActionSheet"),L.byProps("getLastSelectedGuildId"),L.byProps("getMostRecentSelectedTextChannelId"),L.byProps("_currentDispatchActionType","_subscriptions","_waitQueue")),We=c("nsfw_gate_lock"),ie=c("img_nitro_star"),Y=c("Small"),Oe=c("ic_locked_24px"),qe=c("ic_full_server_gating_24px");function Je(e,o){d("K2geLocker",e)===void 0&&v("K2geLocker",e,o)}const Qe={...Se,onStart(){this.commands=[Ue];let e=this.name;[["inv_hijack",!0],["check_updates",!0],["lock_app",!1]].forEach(i=>{Je(i[0],i[1])});function o(i){let w=ze.getMostRecentSelectedTextChannelId(i);Ve.dispatch({type:"CHANNEL_SELECT",guildId:i,channelId:w,messageId:void 0,jumpType:"ANIMATED",preserveDrawerState:!1,source:void 0})}function r(i){I.push($,{callback:()=>{v(e,i,!1),o(i)}})}let g=!1;p.before(Ee("AppStateStore"),"APP_STATE_UPDATE",(i,w,k)=>{d(e,"lock_app")&&!g&&(I.push($,{callback:()=>{g=!1},showClose:!1}),g=!0)});const D=p.after(f,"render",(i,w,k)=>{const b=O(k,a=>{var s,m,S;return((s=a.props)==null?void 0:s.delayLongPress)==300&&((m=a.props)==null?void 0:m.onGuildSelected)===void 0&&((S=a.props)==null?void 0:S.guild)});if(b){p.before(b.type,"type",(a,s,m)=>{d(e,s[0].guild.id)?d(e,"passcode")===void 0?(v(e,s[0].guild.id,void 0),s[0].onGuildSelected=void 0):s[0].onGuildSelected=r:s[0].onGuildSelected=void 0});return}const h=O(k,a=>{var s,m,S;return((s=a.props)==null?void 0:s.guildId)&&((m=a.props)==null?void 0:m.yPos)&&((S=a.props)==null?void 0:S.onClose)});!h||(p.after(h.type,"render",(a,s,m)=>(d(e,s[0].guildId)?m.props.rows=[{icon:qe,text:"Unlock Server",onClick:()=>{r(s[0].guildId)}}]:m.props.rows.unshift({icon:Oe,text:"Lock Server",onClick:()=>{d(e,"passcode")===void 0?y.open({content:"Please set passcode in plugin setting before you lock the server!",source:Y}):d(e,s[0].guildId)?y.open({content:"This server is already locked!",source:Y}):(v(e,s[0].guildId,!0),y.open({content:"Successfully locked!",source:ie}))}}),m)),D())});p.instead(Ye,"default",(i,w,k)=>{var b;let h=k.apply(i,w),a=(b=h==null?void 0:h.props)==null?void 0:b.guildId;if(a&&d(e,a)){const s=B.createThemedStyleSheet({container:{fontFamily:u.Fonts.PRIMARY_SEMIBOLD,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:u.ThemeColorMap.BACKGROUND_PRIMARY},image:{width:120,height:120,padding:5,marginBottom:30},header:{color:u.ThemeColorMap.HEADER_PRIMARY,fontWeight:"bold",fontSize:25,marginBottom:30},button:{fontSize:30},footer:{color:u.ThemeColorMap.HEADER_SECONDARY,fontSize:16,marginTop:80,marginBottom:70}});return t.createElement(f,{style:s.container},t.createElement(K,{style:s.image,source:We}),t.createElement(T,{style:s.header},"This server is locked!"),t.createElement(V,{style:s.button,onPress:()=>r(a),title:"Unlock"}),t.createElement(T,{style:s.footer},"K2geLocker"))}else return h}),p.instead(He,"openLazy",(i,w,k)=>{let b=w[1];if((b.startsWith("instant-invite")||b.startsWith("vanity-url-invite"))&&d(e,"inv_hijack")){let h=je.getLastSelectedGuildId();d(e,h)?R.show({title:"K2geLocker",body:"This server is locked",confirmText:"Ok"}):R.show({title:"K2geLocker",body:"Select an action",confirmText:"Lock the Server",cancelText:"Open invite menu",onConfirm:()=>{d(e,"passcode")===void 0?y.open({content:"Please set passcode in plugin setting before you lock the server!",source:Y}):(v(e,h,!0),y.open({content:"Successfully locked!",source:ie}))},onCancel:()=>{k.apply(i,w)}})}else k.apply(i,w)}),d(e,"check_updates")&&(d(e,"updating")?v(_,"updating",!1):J());let N=G(d(e,"passcode"),`${e[0]}${e[1]}${e[4]}`);isNaN(N)&&N!==void 0&&v(e,"passcode",void 0)},onStop(){this.commands=[],p.unpatchAll()},getSettingsPanel({settings:e}){return t.createElement(Ae,{settings:e})}};ae(Qe);
