const s=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const r=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const m=window.enmity.modules.common.Toasts,Y=window.enmity.modules.common.Dialog;window.enmity.modules.common.Token,window.enmity.modules.common.REST,window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const I=window.enmity.modules.common.Navigation,q=window.enmity.modules.common.NavigationNative,A=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme,window.enmity.modules.common.Linking;const B=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;function X(e){window.enmity.plugins.registerPlugin(e)}const F={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,n)=>window.enmity.modules.filters.byName(e,n),byTypeName:(e,n)=>window.enmity.modules.filters.byTypeName(e,n),byDisplayName:(e,n)=>window.enmity.modules.filters.byDisplayName(e,n)};function J(...e){return window.enmity.modules.bulk(...e)}window.enmity.modules.common;const{components:o}=window.enmity;o.Alert;const Q=o.Button;o.FlatList;const G=o.Image;o.ImageBackground,o.KeyboardAvoidingView,o.Modal,o.Pressable,o.RefreshControl,o.ScrollView,o.SectionList,o.StatusBar,o.StyleSheet,o.Switch;const k=o.Text,H=o.TextInput;o.TouchableHighlight,o.TouchableOpacity,o.TouchableWithoutFeedback,o.Touchable;const _=o.View;o.VirtualizedList,o.Form,o.FormArrow,o.FormCTA,o.FormCTAButton,o.FormCardSection,o.FormCheckbox;const Z=o.FormDivider;o.FormHint,o.FormIcon;const ee=o.FormInput;o.FormLabel,o.FormRadio;const oe=o.FormRow,te=o.FormSection;o.FormSelect,o.FormSubLabel;const ne=o.FormSwitch;o.FormTernaryCheckBox,o.FormText,o.FormTextColors,o.FormTextSizes;function b(e,n,l){window.enmity.settings.set(e,n,l)}function u(e,n,l){return window.enmity.settings.get(e,n,l)}function re(e){return window.enmity.patcher.create(e)}function g(e){return window.enmity.assets.getIDByName(e)}function x(e,n){let l="";for(let w=0;w<e.length;w++)l+=String.fromCharCode(e.charCodeAt(w)^n.charCodeAt(w%n.length));return l}const T="Love K2ge3 lol",se=g("img_nitro_star"),ie=g("Small");var le=({settings:e})=>r.createElement(_,null,r.createElement(te,{title:"Settings"},r.createElement(ee,{value:e.get("passcode"),title:"Passcode",placeholder:"input your custom passcode here!",onSubmitEditing:n=>{if(n.nativeEvent.text=="")m.open({content:"Please enter your custom passcode",source:ie});else{let l=x(n.nativeEvent.text,`${T[5]}${T[6]}${T[0]}`);e.set("passcode",l),m.open({content:"Successfully set new passcode!",source:se})}},secureTextEntry:!0}),r.createElement(Z,null),r.createElement(oe,{label:"Enable invitation menu hijacking",trailing:r.createElement(ne,{value:e.getBoolean("inv_hijack",!0),onValueChange:n=>{e.set("inv_hijack",n)}})}))),U;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(U||(U={}));var P;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(P||(P={}));var $;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})($||($={}));var z;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(z||(z={}));var j;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number",e[e.Attachment=11]="Attachment"})(j||(j={}));var O;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(O||(O={}));const ce=g("img_nitro_star"),ae=g("Small"),de={id:"lock",name:"lock",displayName:"lock",description:"Lock the server with passcode",displayDescription:"Lock the server with passcode",type:P.Chat,execute:async function(e,n){u("K2geLocker","passcode")===void 0?m.open({content:"Please set passcode in plugin setting before you lock the server!",source:ae}):(b("K2geLocker",n.guild.id,!0),m.open({content:"Successfully locked!",source:ce}))}},V=A.createStackNavigator(),p="Love K2ge3 lol",me=g("nsfw_gate_lock"),ue=g("img_nitro_star"),ge=g("Small");var W=({guildId:e,args:n,fn:l})=>{function w(){const a=B.createThemedStyleSheet({container:{fontFamily:s.Fonts.PRIMARY_SEMIBOLD,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:s.ThemeColorMap.BACKGROUND_PRIMARY},image:{width:120,height:120,padding:5,marginBottom:30},header:{color:s.ThemeColorMap.HEADER_PRIMARY,fontWeight:"bold",fontSize:25},text:{color:s.ThemeColorMap.HEADER_SECONDARY,fontSize:16},passcode:{width:100,height:20,marginTop:30,borderWidth:1,borderColor:s.ThemeColorMap.HEADER_SECONDARY,backgroundColor:s.ThemeColorMap.HEADER_SECONDARY},footer:{color:s.ThemeColorMap.HEADER_SECONDARY,fontSize:16,marginTop:100,marginBottom:70}});return r.createElement(_,{style:a.container},r.createElement(G,{style:a.image,source:me}),r.createElement(k,{style:a.header},"This server is locked!"),r.createElement(k,{style:a.text},"enter passcode to unlock"),r.createElement(H,{style:a.passcode,onSubmitEditing:h=>{h.nativeEvent.text==x(u("K2geLocker","passcode"),`${p[5]}${p[6]}${p[0]}`)?(b("K2geLocker",e,!1),l(...n),m.open({content:"Successfully unlocked!",source:ue}),I.pop()):m.open({content:"Incorrect password. Try again.",source:ge})},secureTextEntry:!0}),r.createElement(k,{style:a.footer},"K2geLocker"))}const f=B.createThemedStyleSheet({container:{backgroundColor:s.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:s.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:s.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:s.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:s.ThemeColorMap.HEADER_PRIMARY},close:{color:s.ThemeColorMap.HEADER_PRIMARY}});return r.createElement(q.NavigationContainer,null,r.createElement(V.Navigator,{initialRouteName:"K2egeLocker",style:f.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:f.cardStyle,headerStyle:f.header,headerTitleContainerStyle:f.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},r.createElement(V.Screen,{name:"K2geLocker",component:w,options:{headerTitleStyle:{color:"white"},headerLeft:()=>r.createElement(Q,{color:f.close.color,title:"Close",onPress:()=>I.pop()}),...A.TransitionPresets.ModalSlideFromBottomIOS}})))};function M(e,n,l){return window.enmity.utilities.findInReactTree(e,n,l)}const S=re("K2geLocker"),[he,we,ye]=J(F.byName("MessagesConnected",!1),F.byProps("openLazy","hideActionSheet"),F.byName("GuildTooltipActionSheets",!1)),ve=g("nsfw_gate_lock"),K=g("img_nitro_star"),D=g("Small"),Se=g("ic_locked_24px"),fe=g("ic_full_server_gating_24px"),Ee={name:"K2geLocker",version:"1.1.0",description:"Lock the specific server with passcode.",authors:[{name:"mafu",id:"519760564755365888"}],onStart(){this.commands=[de];let e={},n={},l="0",w=this.name;u(this.name,"inv_hijack")===void 0&&b(this.name,"inv_hijack",!0);const f=S.after(_,"render",(a,h,v)=>{const y=M(v,i=>{var t,d,c;return((t=i.props)==null?void 0:t.delayLongPress)==300&&((d=i.props)==null?void 0:d.onGuildSelected)===void 0&&((c=i.props)==null?void 0:c.guild)});if(y){S.before(y.type,"type",(i,t,d)=>{n[t[0].guild.id]=t[0].onLongPress,u(this.name,t[0].guild.id)?t[0].onGuildSelected=c=>{I.push(W,{guildId:c,args:e[c],fn:n[c]})}:t[0].onGuildSelected=void 0}),S.before(y.props,"onPressOut",(i,t,d)=>{var c,R;let N=M((R=(c=t[0]._targetInst)==null?void 0:c.pendingProps)==null?void 0:R.children,L=>{var C;return(C=L.props)==null?void 0:C.guild});e[N.props.guild.id]=[i,t]}),S.before(y.props,"onLongPress",(i,t,d)=>{var c,R;let N=M((R=(c=t[0]._targetInst)==null?void 0:c.pendingProps)==null?void 0:R.children,L=>{var C;return(C=L.props)==null?void 0:C.guild});e[N.props.guild.id]=[i,t]});return}const E=M(v,i=>{var t,d,c;return((t=i.props)==null?void 0:t.guildId)&&((d=i.props)==null?void 0:d.yPos)&&((c=i.props)==null?void 0:c.onClose)});!E||(S.after(E.type,"render",(i,t,d)=>(u(this.name,t[0].guildId)?d.props.rows=[{icon:fe,text:"Unlock Server",onClick:()=>{I.push(W,{guildId:t[0].guildId,args:e[t[0].guildId],fn:n[t[0].guildId]})}}]:d.props.rows.unshift({icon:Se,text:"Lock Server",onClick:()=>{u(this.name,"passcode")===void 0?m.open({content:"Please set passcode in plugin setting before you lock the server!",source:D}):u(this.name,t[0].guildId)?m.open({content:"This server is already locked!",source:D}):(b(this.name,t[0].guildId,!0),m.open({content:"Successfully locked!",source:K}))}}),d)),f())});S.instead(ye,"default",(a,h,v)=>(l=h[0].guildId,v.apply(a,h))),S.instead(he,"default",(a,h,v)=>{var y;let E=v.apply(a,h),i=(y=E==null?void 0:E.props)==null?void 0:y.guildId;if(i&&u(this.name,i)){const t=B.createThemedStyleSheet({container:{fontFamily:s.Fonts.PRIMARY_SEMIBOLD,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:s.ThemeColorMap.BACKGROUND_PRIMARY},image:{width:120,height:120,padding:5,marginBottom:30},header:{color:s.ThemeColorMap.HEADER_PRIMARY,fontWeight:"bold",fontSize:25},text:{color:s.ThemeColorMap.HEADER_SECONDARY,fontSize:16},passcode:{width:100,height:20,marginTop:30,borderWidth:1,borderColor:s.ThemeColorMap.HEADER_SECONDARY,backgroundColor:s.ThemeColorMap.HEADER_SECONDARY},footer:{color:s.ThemeColorMap.HEADER_SECONDARY,fontSize:16,marginTop:100,marginBottom:70}});return r.createElement(_,{style:t.container},r.createElement(G,{style:t.image,source:ve}),r.createElement(k,{style:t.header},"This server is locked!"),r.createElement(k,{style:t.text},"enter passcode to unlock"),r.createElement(H,{style:t.passcode,onSubmitEditing:d=>{d.nativeEvent.text==x(u(this.name,"passcode"),`${w[0]}${w[1]}${w[4]}`)?(b(this.name,i,!1),m.open({content:"Successfully unlocked!",source:K})):m.open({content:"Incorrect password. Try again.",source:D})},secureTextEntry:!0}),r.createElement(k,{style:t.footer},"K2geLocker"))}else return E}),S.instead(we,"openLazy",(a,h,v)=>{let y=h[1];(y.startsWith("instant-invite")||y.startsWith("vanity-url-invite"))&&u(this.name,"inv_hijack")?u(this.name,l)?Y.show({title:"K2geLocker",body:"This server is locked",confirmText:"Ok"}):Y.show({title:"K2geLocker",body:"Select an action",confirmText:"Lock the Server",cancelText:"Open invite menu",onConfirm:()=>{u(this.name,"passcode")===void 0?m.open({content:"Please set passcode in plugin setting before you lock the server!",source:D}):(b(this.name,l,!0),m.open({content:"Successfully locked!",source:K}))},onCancel:()=>{v.apply(a,h)}}):v.apply(a,h)})},onStop(){this.commands=[],S.unpatchAll()},getSettingsPanel({settings:e}){return r.createElement(le,{settings:e})}};X(Ee);
