const y=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const _=window.enmity.modules.common.Toasts,I=window.enmity.modules.common.Dialog;window.enmity.modules.common.Token;const q=window.enmity.modules.common.REST;window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const P=window.enmity.modules.common.Navigation,we=window.enmity.modules.common.NavigationNative,X=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme;const U=window.enmity.modules.common.Linking,K=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;function fe(e){window.enmity.plugins.registerPlugin(e)}function ye(e){return window.enmity.plugins.getPlugin(e)}const x={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,o)=>window.enmity.modules.filters.byName(e,o),byTypeName:(e,o)=>window.enmity.modules.filters.byTypeName(e,o),byDisplayName:(e,o)=>window.enmity.modules.filters.byDisplayName(e,o)};function Se(e,o){return window.enmity.modules.getModule(e,o)}function Q(...e){return window.enmity.modules.bulk(...e)}window.enmity.modules.common;const{components:n}=window.enmity;n.Alert;const H=n.Button;n.FlatList;const $=n.Image;n.ImageBackground,n.KeyboardAvoidingView,n.Modal,n.Pressable,n.RefreshControl;const be=n.ScrollView;n.SectionList,n.StatusBar,n.StyleSheet,n.Switch;const R=n.Text;n.TextInput,n.TouchableHighlight;const _e=n.TouchableOpacity;n.TouchableWithoutFeedback,n.Touchable;const p=n.View;n.VirtualizedList,n.Form,n.FormArrow,n.FormCTA,n.FormCTAButton,n.FormCardSection,n.FormCheckbox,n.FormDivider,n.FormHint,n.FormIcon,n.FormInput,n.FormLabel,n.FormRadio;const h=n.FormRow,Z=n.FormSection;n.FormSelect,n.FormSubLabel;const Y=n.FormSwitch;n.FormTernaryCheckBox,n.FormText,n.FormTextColors,n.FormTextSizes;function S(e,o,r){window.enmity.settings.set(e,o,r)}function s(e,o,r){return window.enmity.settings.get(e,o,r)}function ve(e){return window.enmity.patcher.create(e)}function c(e){return window.enmity.assets.getIDByName(e)}function ee(e,o,r){return window.enmity.utilities.findInReactTree(e,o,r)}var k="K2geLocker",te="1.2.4",pe="Lock App / Server with passcode!",Ee=[{name:"mafu",id:"519760564755365888"}],ke="#00fa9a",Le={name:k,version:te,description:pe,authors:Ee,color:ke};function j(e,o){let r="";for(let b=0;b<e.length;b++)r+=String.fromCharCode(e.charCodeAt(b)^o.charCodeAt(b%o.length));return r}const Ce=Se(e=>e._dispatcher._actionHandlers._dependencyGraph.nodes),z=Ce._dispatcher._actionHandlers._dependencyGraph.nodes;function G(e){let o=Object.keys(z).filter(r=>z[r].name===e);if(o)return z[o[0]].actionHandler}const{native:B}=window.enmity;function oe(){B.reload()}B.version,B.build,B.device,B.version;const Ie="https://github.com/m4fn3/K2geLocker",Re="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/manifest.json",Te="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/dist/K2geLocker.js",Ne="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/changelogs.json";function Me(e,o){window.enmity.plugins.installPlugin(Te,()=>{I.show({title:"K2geLocker",body:`Updated from ${e} to ${o}!
Do you want to reload Discord now?`,confirmText:"Yes",cancelText:"Later",onConfirm:()=>oe()})})}function ne(e=!1){q.get(Re).then(o=>{const r=JSON.parse(o.text),b=ye(r.name);r.version.localeCompare(b.version,void 0,{numeric:!0})===1?(e||!e&&s(k,"ignored")!=r.version)&&q.get(Ne).then(T=>{const N=JSON.parse(T.text);let a="";N[r.version]&&(a=`

- Changelogs
${N[r.version]}`),I.show({title:"K2geLocker",body:`New version v${r.version} is available!${a}`,confirmText:"Update",cancelText:"Ignore",onConfirm:()=>{S(k,"_updating",!0),Me(b.version,r.version)},onCancel:()=>S(k,"ignored",r.version)})}):e&&I.show({title:"K2geLocker",body:`You are using latest version v${b.version}!`,confirmText:"OK"})}).catch(o=>{o.status===404&&I.show({title:"K2geLocker",body:"Failed to check for updates. Please check GitHub manually.",confirmText:"GitHub",cancelText:"Close",onConfirm:()=>U.openURL(Ie)})})}const re=X.createStackNavigator(),[Pe]=Q(x.byProps("AppState")),D="Love K2ge3 lol";c("nsfw_gate_lock");const ie=c("img_nitro_star");c("ic_following");const xe=c("ic_info_24px"),le=c("Small"),De=c("ic_arrow_back_24px"),O=K.createThemedStyleSheet({container:{backgroundColor:y.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:y.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:y.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:y.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:y.ThemeColorMap.HEADER_PRIMARY},close:{color:y.ThemeColorMap.HEADER_PRIMARY}});function V({callback:e=null,isSetup:o=!1,showClose:r=!0}){const b=Pe.useWindowDimensions().width,T=Math.min(b,450);function N(){const a=K.createThemedStyleSheet({container:{flex:1,backgroundColor:y.ThemeColorMap.BACKGROUND_PRIMARY,alignSelf:"center",alignItems:"center",justifyContent:"center",width:T},title:{height:40},titleText:{color:y.ThemeColorMap.HEADER_PRIMARY,fontSize:30},circleBox:{flexDirection:"row",height:130,paddingTop:20},white_circle:{width:20,height:20,borderRadius:10,backgroundColor:"white",marginRight:10},gray_circle:{width:20,height:20,borderRadius:10,backgroundColor:"gray",marginRight:10},numberBox:{flexDirection:"row",flexWrap:"wrap",width:300},number:{width:100,height:70,alignItems:"center",justifyContent:"center"},numberText:{color:y.ThemeColorMap.HEADER_PRIMARY,fontSize:30}});let M=s(k,"passcode"),F=M===void 0?"pass":j(M,`${D[5]}${D[6]}${D[0]}`);const[C,i]=t.useState(""),[w,g]=t.useState("");let d=new Array(F.length).fill(a.gray_circle);const[f,m]=t.useState(d);let l=o?"Enter new passcode":"Enter passcode ";return t.createElement(p,{style:a.container},t.createElement(p,{style:a.title},t.createElement(R,{style:a.titleText},l)),t.createElement(p,{style:a.circleBox},f.map((u,v)=>t.createElement(p,{style:f[v]}))),t.createElement(p,{style:a.numberBox},[1,2,3,4,5,6,7,8,9,"",0,"back"].map((u,v)=>u!==""?t.createElement(_e,{style:a.number,key:v,onPress:()=>{if(typeof u=="number"){let L=w+u.toString();g(L);let A=f;A[L.length-1]=a.white_circle,m(A),L.length===f.length&&setTimeout(()=>{if(!o)L===F?(P.pop(),e(),_.open({content:"Successfully unlocked!",source:ie})):(g(""),m(d),_.open({content:"Incorrect password. Try again.",source:le}));else if(!C)i(L),g(""),d=new Array(f.length).fill(a.gray_circle),m(d),_.open({content:"Retype new passcode to confirm.",source:xe});else{if(C===L){let he=j(C,`${D[5]}${D[6]}${D[0]}`);S(k,"passcode",he),_.open({content:"Successfully set new passcode!",source:ie})}else _.open({content:"Passcode didn't match.",source:le});P.pop()}},200)}else{let L=w.slice(0,-1);g(L);let A=f;A[L.length]=a.gray_circle,m(A)}}},typeof u=="number"?t.createElement(R,{style:a.numberText},u):t.createElement($,{source:De})):t.createElement(p,{style:a.number,key:v}))),t.createElement(p,null,[1].filter(u=>o&&!C).map(u=>t.createElement(H,{onPress:()=>{let v=f.length===4?6:4;d=new Array(v).fill(a.gray_circle),m(d),g("")},title:"Change passcode length"}))))}return t.createElement(we.NavigationContainer,null,t.createElement(re.Navigator,{initialRouteName:"K2geLocker",style:O.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:O.cardStyle,headerStyle:O.header,headerTitleContainerStyle:O.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},t.createElement(re.Screen,{name:"K2geLocker",component:N,options:{headerTitleStyle:{color:"white"},headerLeft:()=>{if(r)return t.createElement(H,{color:O.close.color,title:"Close",onPress:()=>P.pop()})},...X.TransitionPresets.ModalSlideFromBottomIOS}})))}const Ae="Love K2ge3 lol";c("img_nitro_star");const Be=c("Small"),Oe=c("img_account_sync_github_white"),Fe=c("img_account_sync_twitter_white"),Ke=c("ic_message_retry"),Ge=c("hub-invite"),Ue=c("ic_lock"),He=c("toast_image_saved"),$e=c("ic_drag_icon_24px");var Ye=({settings:e})=>{const o=K.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:y.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:y.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"},footer:{color:y.ThemeColorMap.HEADER_SECONDARY,textAlign:"center",paddingTop:10,paddingBottom:20}});return t.createElement(be,null,t.createElement(p,{style:o.container},t.createElement($,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:o.image}),t.createElement(p,{style:o.title},t.createElement(R,{style:o.name},"K2geLocker"),t.createElement(R,{style:o.author},"by mafu"))),t.createElement(Z,{title:"SETTINGS"},t.createElement(h,{label:"Setup Passcode",trailing:h.Arrow,leading:t.createElement(h.Icon,{source:$e}),subLabel:"Open password setup modal",onPress:()=>{P.push(V,{isSetup:!0})}}),t.createElement(h,{label:"Reload Discord",trailing:h.Arrow,leading:t.createElement(h.Icon,{source:Ke}),subLabel:"Reloading is required in order to properly initialize K2geLocker after enabling plugin",onPress:()=>{oe()}}),t.createElement(h,{label:"Enable app-wide locking",subLabel:"You can lock entire app with passcode!",leading:t.createElement(h.Icon,{source:Ue}),trailing:t.createElement(Y,{value:e.getBoolean("lock_app",!1),onValueChange:r=>{r&&e.get("passcode")===void 0?(_.open({content:"Please set passcode in plugin setting first!",source:Be}),r=!1):(e.set("lock_app",r),S(Ae,"_locked",!1))}})}),t.createElement(h,{label:"Enable invitation menu hijacking",subLabel:"Useful for iPad on which can't long press icon. For servers with inv disabled, use /lock command.",leading:t.createElement(h.Icon,{source:Ge}),trailing:t.createElement(Y,{value:e.getBoolean("inv_hijack",!0),onValueChange:r=>{e.set("inv_hijack",r)}})}),t.createElement(h,{label:"Check for updates",subLabel:"Whether automatically check or not. You can tap here to check manually too.",leading:t.createElement(h.Icon,{source:He}),trailing:t.createElement(Y,{value:e.getBoolean("check_updates",!0),onValueChange:r=>{e.set("check_updates",r)}}),onPress:()=>{ne(!0)}})),t.createElement(Z,{title:"INFORMATION"},t.createElement(h,{label:"Twitter @m4fn3",style:o.info,trailing:h.Arrow,leading:t.createElement(h.Icon,{source:Fe}),onPress:()=>{U.openURL("https://twitter.com/m4fn3")}}),t.createElement(h,{label:"GitHub (m4fn3)",style:o.info,trailing:h.Arrow,leading:t.createElement(h.Icon,{source:Oe}),onPress:()=>{U.openURL("https://github.com/m4fn3/K2geLocker")}})),t.createElement(R,{style:o.footer},`v${te}`))},se;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(se||(se={}));var W;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(W||(W={}));var ce;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(ce||(ce={}));var ae;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(ae||(ae={}));var de;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number",e[e.Attachment=11]="Attachment"})(de||(de={}));var me;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(me||(me={}));const je=c("img_nitro_star"),ze=c("Small"),Ve={id:"lock",name:"lock",displayName:"lock",description:"Lock the server with passcode",displayDescription:"Lock the server with passcode",type:W.Chat,execute:async function(e,o){s(k,"passcode")===void 0?_.open({content:"Please set passcode in plugin setting before you lock the server!",source:ze}):(S(k,o.guild.id,!0),_.open({content:"Successfully locked!",source:je}))}},E=ve("K2geLocker"),[We,Je,qe,Xe,Qe]=Q(x.byName("MessagesConnected",!1),x.byProps("openLazy","hideActionSheet"),x.byProps("getLastSelectedGuildId"),x.byProps("getMostRecentSelectedTextChannelId"),x.byProps("_currentDispatchActionType","_subscriptions","_waitQueue")),[Ze,et,ue,tt]=[G("AppStateStore"),G("DeveloperOptionsStore"),G("ModalDeprecatedStore"),G("GatewayConnectionStore")],ot=c("nsfw_gate_lock"),ge=c("img_nitro_star"),J=c("Small"),nt=c("ic_locked_24px"),rt=c("ic_full_server_gating_24px");function it(e,o){s("K2geLocker",e)===void 0&&S("K2geLocker",e,o)}const lt={...Le,onStart(){this.commands=[Ve];let e=this.name;[["inv_hijack",!0],["check_updates",!0],["lock_app",!1]].forEach(i=>{it(i[0],i[1])});function o(i){let w=Xe.getMostRecentSelectedTextChannelId(i);Qe.dispatch({type:"CHANNEL_SELECT",guildId:i,channelId:w,messageId:void 0,jumpType:"ANIMATED",preserveDrawerState:!1,source:void 0})}function r(i){P.push(V,{callback:()=>{S(e,i,!1),o(i)}})}function b(){P.push(V,{callback:()=>{S(e,"_locked",!1)},showClose:!1})}let T=!0;s(e,"lock_app")&&s(e,"_locked")&&s(e,"passcode")!==void 0&&b(),E.before(Ze,"APP_STATE_UPDATE",(i,w,g)=>{let d=w[0].state;s(e,"lock_app")&&!s(e,"_locked")&&(s(e,"passcode")===void 0?S(e,"lock_app",!1):(T||d=="background")&&(b(),S(e,"_locked",!0),T=!1))});const N=E.after(p,"render",(i,w,g)=>{const d=ee(g,m=>{var l,u,v;return((l=m.props)==null?void 0:l.delayLongPress)==300&&((u=m.props)==null?void 0:u.onGuildSelected)===void 0&&((v=m.props)==null?void 0:v.guild)});if(d){E.before(d.type,"type",(m,l,u)=>{s(e,l[0].guild.id)?s(e,"passcode")===void 0?(S(e,l[0].guild.id,void 0),l[0].onGuildSelected=void 0):l[0].onGuildSelected=r:l[0].onGuildSelected=void 0});return}const f=ee(g,m=>{var l,u,v;return((l=m.props)==null?void 0:l.guildId)&&((u=m.props)==null?void 0:u.yPos)&&((v=m.props)==null?void 0:v.onClose)});!f||(E.after(f.type,"render",(m,l,u)=>(s(e,l[0].guildId)?u.props.rows=[{icon:rt,text:"Unlock Server",onClick:()=>{r(l[0].guildId)}}]:u.props.rows.unshift({icon:nt,text:"Lock Server",onClick:()=>{s(e,"passcode")===void 0?_.open({content:"Please set passcode in plugin setting before you lock the server!",source:J}):s(e,l[0].guildId)?_.open({content:"This server is already locked!",source:J}):(S(e,l[0].guildId,!0),_.open({content:"Successfully locked!",source:ge}))}}),u)),N())});E.instead(We,"default",(i,w,g)=>{var d;let f=g.apply(i,w),m=(d=f==null?void 0:f.props)==null?void 0:d.guildId;if(m&&s(e,m)){const l=K.createThemedStyleSheet({container:{fontFamily:y.Fonts.PRIMARY_SEMIBOLD,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:y.ThemeColorMap.BACKGROUND_PRIMARY},image:{width:120,height:120,padding:5,marginBottom:30},header:{color:y.ThemeColorMap.HEADER_PRIMARY,fontWeight:"bold",fontSize:25,marginBottom:30},button:{fontSize:30},footer:{color:y.ThemeColorMap.HEADER_SECONDARY,fontSize:16,marginTop:80,marginBottom:70}});return t.createElement(p,{style:l.container},t.createElement($,{style:l.image,source:ot}),t.createElement(R,{style:l.header},"This server is locked!"),t.createElement(H,{style:l.button,onPress:()=>r(m),title:"Unlock"}),t.createElement(R,{style:l.footer},"K2geLocker"))}else return f}),E.instead(Je,"openLazy",(i,w,g)=>{let d=w[1];if((d.startsWith("instant-invite")||d.startsWith("vanity-url-invite"))&&s(e,"inv_hijack")){let f=qe.getLastSelectedGuildId();s(e,f)?I.show({title:"K2geLocker",body:"This server is locked",confirmText:"Ok"}):I.show({title:"K2geLocker",body:"Select an action",confirmText:"Lock the Server",cancelText:"Open invite menu",onConfirm:()=>{s(e,"passcode")===void 0?_.open({content:"Please set passcode in plugin setting before you lock the server!",source:J}):(S(e,f,!0),_.open({content:"Successfully locked!",source:ge}))},onCancel:()=>{g.apply(i,w)}})}else g.apply(i,w)}),E.before(et,"LOGOUT",(i,w,g)=>{I.show({title:"K2geLocker",body:`Automatically disabled itself to prevent app from causing weird problems!
Please enable plugin manually after you re-login to the account.`,confirmText:"See you again!"}),this.commands=[],E.unpatchAll(),window.enmity.plugins.disablePlugin("K2geLocker")});let a=!1,M=[];E.before(tt,"PUSH_NOTIFICATION_CLICK",(i,w,g)=>{a=!0,M=[]});const F=["MODAL_POP_ALL","CHANGE_LOG_CLOSE","CHANNEL_SETTINGS_CLOSE","GUILD_SETTINGS_CLOSE","EMAIL_VERIFICATION_MODAL_CLOSE","NOTIFICATION_SETTINGS_MODAL_CLOSE","SEARCH_MODAL_CLOSE","USER_SETTINGS_MODAL_CLOSE","MENTION_MODAL_CLOSE"];Object.keys(ue).forEach(i=>{F.includes(i)&&E.instead(ue,i,(w,g,d)=>{a&&!Object.keys(M).includes(i)?M[i]=!0:d.apply(w,g)})}),s(e,"check_updates")&&(s(e,"_updating")?S(k,"_updating",!1):ne());let C=s(k,"passcode");if(C!==void 0){let i=j(C,`${e[0]}${e[1]}${e[4]}`);isNaN(i)&&S(e,"passcode",void 0)}},onStop(){this.commands=[],E.unpatchAll()},getSettingsPanel({settings:e}){return t.createElement(Ye,{settings:e})}};fe(lt);
