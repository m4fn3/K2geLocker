const i=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const d=window.enmity.modules.common.Toasts,k=window.enmity.modules.common.Dialog;window.enmity.modules.common.Token;const Q=window.enmity.modules.common.REST;window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const M=window.enmity.modules.common.Navigation,Z=window.enmity.modules.common.NavigationNative,H=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme;const x=window.enmity.modules.common.Linking,D=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;function ee(e){window.enmity.plugins.registerPlugin(e)}function oe(e){return window.enmity.plugins.getPlugin(e)}const T={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,n)=>window.enmity.modules.filters.byName(e,n),byTypeName:(e,n)=>window.enmity.modules.filters.byTypeName(e,n),byDisplayName:(e,n)=>window.enmity.modules.filters.byDisplayName(e,n)};function te(...e){return window.enmity.modules.bulk(...e)}window.enmity.modules.common;const{components:o}=window.enmity;o.Alert;const ne=o.Button;o.FlatList;const N=o.Image;o.ImageBackground,o.KeyboardAvoidingView,o.Modal,o.Pressable,o.RefreshControl;const re=o.ScrollView;o.SectionList,o.StatusBar,o.StyleSheet,o.Switch;const _=o.Text,U=o.TextInput;o.TouchableHighlight,o.TouchableOpacity,o.TouchableWithoutFeedback,o.Touchable;const L=o.View;o.VirtualizedList,o.Form,o.FormArrow,o.FormCTA,o.FormCTAButton,o.FormCardSection,o.FormCheckbox,o.FormDivider,o.FormHint,o.FormIcon;const ie=o.FormInput;o.FormLabel,o.FormRadio;const u=o.FormRow,$=o.FormSection;o.FormSelect,o.FormSubLabel;const B=o.FormSwitch;o.FormTernaryCheckBox,o.FormText,o.FormTextColors,o.FormTextSizes;function y(e,n,r){window.enmity.settings.set(e,n,r)}function l(e,n,r){return window.enmity.settings.get(e,n,r)}function se(e){return window.enmity.patcher.create(e)}function c(e){return window.enmity.assets.getIDByName(e)}var v="K2geLocker",ae="1.1.1",le="Lock the specific server with passcode.",ce=[{name:"mafu",id:"519760564755365888"}],me={name:v,version:ae,description:le,authors:ce};function F(e,n){let r="";for(let a=0;a<e.length;a++)r+=String.fromCharCode(e.charCodeAt(a)^n.charCodeAt(a%n.length));return r}const{native:I}=window.enmity;function P(){I.reload()}I.version,I.build,I.device,I.version;const de="https://github.com/m4fn3/K2geLocker",ue="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/manifest.json",ge="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/dist/K2geLocker.js";function he(e,n){window.enmity.plugins.installPlugin(ge,()=>{k.show({title:"K2geLocker",body:`Updated from ${e} to ${n}!
Do you want to reload Discord now?`,confirmText:"Yes",cancelText:"Later",onConfirm:()=>P()})})}function z(e=!1){Q.get(ue).then(n=>{const r=JSON.parse(n.text),a=oe(r.name);console.log(r.version.localeCompare(a.version,void 0,{numeric:!0})),r.version.localeCompare(a.version,void 0,{numeric:!0})===1?(e||!e&&l(v,"ignored")!=r.version)&&k.show({title:"K2geLocker",body:`New version v${r.version} is available!`,confirmText:"Update",cancelText:"Ignore",onConfirm:()=>{y(v,"updating",!0),he(a.version,r.version)},onCancel:()=>y(v,"ignored",r.version)}):e&&k.show({title:"K2geLocker",body:`You are using latest version v${a.version}!`,confirmText:"OK"})}).catch(n=>{n.status===404&&k.show({title:"K2geLocker",body:"Failed to check for updates. Please check GitHub manually.",confirmText:"GitHub",cancelText:"Close",onConfirm:()=>x.openURL(de)})})}const K="Love K2ge3 lol",we=c("img_nitro_star"),fe=c("Small"),ye=c("img_account_sync_github_white"),ve=c("img_account_sync_twitter_white"),Ee=c("ic_message_retry"),be=c("hub-invite"),Se=c("debug"),ke=c("toast_image_saved");var _e=({settings:e})=>{const n=D.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:i.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:i.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"}});return t.createElement(re,null,t.createElement(L,{style:n.container},t.createElement(N,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:n.image}),t.createElement(L,{style:n.title},t.createElement(_,{style:n.name},"K2geLocker"),t.createElement(_,{style:n.author},"by mafu"))),t.createElement($,{title:"SETTINGS"},t.createElement(ie,{value:e.get("passcode"),title:"Passcode",placeholder:"input your custom passcode here!",onSubmitEditing:r=>{if(r.nativeEvent.text=="")d.open({content:"Please enter your custom passcode",source:fe});else{let a=F(r.nativeEvent.text,`${K[5]}${K[6]}${K[0]}`);e.set("passcode",a),d.open({content:"Successfully set new passcode!",source:we})}},secureTextEntry:!0}),t.createElement(u,{label:"Reload Discord",trailing:u.Arrow,leading:t.createElement(u.Icon,{source:Ee}),subLabel:"Reloading is required in order to properly initialize K2geLocker after enabling plugin",onPress:()=>{P()}}),t.createElement(u,{label:"Enable invitation menu hijacking",subLabel:"Useful for iPad on which can't long press icon. For servers with inv disabled, use /lock command.",leading:t.createElement(u.Icon,{source:be}),trailing:t.createElement(B,{value:e.getBoolean("inv_hijack",!0),onValueChange:r=>{e.set("inv_hijack",r)}})}),t.createElement(u,{label:"Check for updates",subLabel:"Whether automatically check or not. You can tap here to check manually too.",leading:t.createElement(u.Icon,{source:ke}),trailing:t.createElement(B,{value:e.getBoolean("check_updates",!0),onValueChange:r=>{e.set("check_updates",r)}}),onPress:()=>{z(!0)}}),t.createElement(u,{label:"Disable auto refreshing",subLabel:"Fix bugs on left bar, but an additional action is needed after unlocking.",leading:t.createElement(u.Icon,{source:Se}),trailing:t.createElement(B,{value:e.getBoolean("no_auto_refresh",!1),onValueChange:r=>{e.set("no_auto_refresh",r),k.show({title:"Reload",body:`Reloading is required to apply changes.
Do you want to reload Discord now?`,confirmText:"Yes",cancelText:"Later",onConfirm:()=>{P()}})}})})),t.createElement($,{title:"INFORMATION"},t.createElement(u,{label:"GitHub (m4fn3)",style:n.info,trailing:u.Arrow,leading:t.createElement(u.Icon,{source:ye}),onPress:()=>{x.openURL("https://github.com/m4fn3/K2geLocker")}}),t.createElement(u,{label:"Twitter @m4fn3",style:n.info,trailing:u.Arrow,leading:t.createElement(u.Icon,{source:ve}),onPress:()=>{x.openURL("https://twitter.com/m4fn3")}})))},j;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(j||(j={}));var Y;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(Y||(Y={}));var O;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(O||(O={}));var V;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(V||(V={}));var W;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number",e[e.Attachment=11]="Attachment"})(W||(W={}));var q;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(q||(q={}));const Re=c("img_nitro_star"),pe=c("Small"),Ce={id:"lock",name:"lock",displayName:"lock",description:"Lock the server with passcode",displayDescription:"Lock the server with passcode",type:Y.Chat,execute:async function(e,n){l(v,"passcode")===void 0?d.open({content:"Please set passcode in plugin setting before you lock the server!",source:pe}):(y(v,n.guild.id,!0),d.open({content:"Successfully locked!",source:Re}))}},J=H.createStackNavigator(),A="Love K2ge3 lol",Le=c("nsfw_gate_lock"),Ie=c("img_nitro_star"),De=c("Small");var Te=({guildId:e,fn:n})=>{function r(){const S=D.createThemedStyleSheet({container:{fontFamily:i.Fonts.PRIMARY_SEMIBOLD,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:i.ThemeColorMap.BACKGROUND_PRIMARY},image:{width:120,height:120,padding:5,marginBottom:30},header:{color:i.ThemeColorMap.HEADER_PRIMARY,fontWeight:"bold",fontSize:25},text:{color:i.ThemeColorMap.HEADER_SECONDARY,fontSize:16},passcode:{width:100,height:20,marginTop:30,borderWidth:1,borderColor:i.ThemeColorMap.HEADER_SECONDARY,backgroundColor:i.ThemeColorMap.HEADER_SECONDARY},footer:{color:i.ThemeColorMap.HEADER_SECONDARY,fontSize:16,marginTop:100,marginBottom:70}});return t.createElement(L,{style:S.container},t.createElement(N,{style:S.image,source:Le}),t.createElement(_,{style:S.header},"This server is locked!"),t.createElement(_,{style:S.text},"enter passcode to unlock"),t.createElement(U,{style:S.passcode,onSubmitEditing:g=>{if(g.nativeEvent.text==F(l(v,"passcode"),`${A[5]}${A[6]}${A[0]}`)){y(v,e,!1),n();let h="Successfully unlocked!";l(v,"no_auto_refresh")&&(h="Now, long press on server icon to apply unlocking!"),d.open({content:h,source:Ie}),M.pop()}else d.open({content:"Incorrect password. Try again.",source:De})},secureTextEntry:!0}),t.createElement(_,{style:S.footer},"K2geLocker"))}const a=D.createThemedStyleSheet({container:{backgroundColor:i.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:i.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:i.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:i.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:i.ThemeColorMap.HEADER_PRIMARY},close:{color:i.ThemeColorMap.HEADER_PRIMARY}});return t.createElement(Z.NavigationContainer,null,t.createElement(J.Navigator,{initialRouteName:"K2egeLocker",style:a.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:a.cardStyle,headerStyle:a.header,headerTitleContainerStyle:a.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},t.createElement(J.Screen,{name:"K2geLocker",component:r,options:{headerTitleStyle:{color:"white"},headerLeft:()=>t.createElement(ne,{color:a.close.color,title:"Close",onPress:()=>M.pop()}),...H.TransitionPresets.ModalSlideFromBottomIOS}})))};function X(e,n,r){return window.enmity.utilities.findInReactTree(e,n,r)}const b=se("K2geLocker"),[Me,xe,Ne,Be]=te(T.byName("MessagesConnected",!1),T.byProps("openLazy","hideActionSheet"),T.byName("GuildTooltipActionSheets",!1),T.byName("GuildsConnected",!1)),Fe=c("nsfw_gate_lock"),G=c("img_nitro_star"),p=c("Small"),Pe=c("ic_locked_24px"),Ke=c("ic_full_server_gating_24px"),Ye={...me,onStart(){this.commands=[Ce];let e,n="0",r=this.name;l(this.name,"inv_hijack")===void 0&&y(this.name,"inv_hijack",!0),l(this.name,"no_auto_refresh")===void 0&&y(this.name,"no_auto_refresh",!1),l(this.name,"check_updates")===void 0&&y(this.name,"check_updates",!0),l(this.name,"no_auto_refresh")?e=()=>{}:b.after(Be,"default",(g,h,f)=>{b.after(f,"type",(E,R,m)=>{e=m.handleGuildFolderExpand})});function a(g){e===void 0?d.open({content:"You need to reload Discord first to properly initialize K2geLocker.",source:p}):l("K2geLocker",g)?M.push(Te,{guildId:g,fn:e}):k.show({title:"Refreshing server is needed!",body:`Long press on the icon of server you unlocked to refresh and apply unlocking!
If you don't want this behavior, change option in plugin settings.`,confirmText:"OK"})}const S=b.after(L,"render",(g,h,f)=>{const E=X(f,m=>{var s,w,C;return((s=m.props)==null?void 0:s.delayLongPress)==300&&((w=m.props)==null?void 0:w.onGuildSelected)===void 0&&((C=m.props)==null?void 0:C.guild)});if(E){b.before(E.type,"type",(m,s,w)=>{l(this.name,s[0].guild.id)?s[0].onGuildSelected=a:s[0].onGuildSelected=void 0});return}const R=X(f,m=>{var s,w,C;return((s=m.props)==null?void 0:s.guildId)&&((w=m.props)==null?void 0:w.yPos)&&((C=m.props)==null?void 0:C.onClose)});!R||(b.after(R.type,"render",(m,s,w)=>(l(this.name,s[0].guildId)?w.props.rows=[{icon:Ke,text:"Unlock Server",onClick:()=>{a(s[0].guildId)}}]:w.props.rows.unshift({icon:Pe,text:"Lock Server",onClick:()=>{l(this.name,"passcode")===void 0?d.open({content:"Please set passcode in plugin setting before you lock the server!",source:p}):e===void 0?d.open({content:"You need to reload Discord first to properly initialize K2geLocker.",source:p}):l(this.name,s[0].guildId)?d.open({content:"This server is already locked!",source:p}):(y(this.name,s[0].guildId,!0),e(),d.open({content:"Successfully locked!",source:G}))}}),w)),S())});b.instead(Ne,"default",(g,h,f)=>(n=h[0].guildId,f.apply(g,h))),b.instead(Me,"default",(g,h,f)=>{var E;let R=f.apply(g,h),m=(E=R==null?void 0:R.props)==null?void 0:E.guildId;if(m&&l(this.name,m)){const s=D.createThemedStyleSheet({container:{fontFamily:i.Fonts.PRIMARY_SEMIBOLD,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:i.ThemeColorMap.BACKGROUND_PRIMARY},image:{width:120,height:120,padding:5,marginBottom:30},header:{color:i.ThemeColorMap.HEADER_PRIMARY,fontWeight:"bold",fontSize:25},text:{color:i.ThemeColorMap.HEADER_SECONDARY,fontSize:16},passcode:{width:100,height:20,marginTop:30,borderWidth:1,borderColor:i.ThemeColorMap.HEADER_SECONDARY,backgroundColor:i.ThemeColorMap.HEADER_SECONDARY},footer:{color:i.ThemeColorMap.HEADER_SECONDARY,fontSize:16,marginTop:100,marginBottom:70}});return t.createElement(L,{style:s.container},t.createElement(N,{style:s.image,source:Fe}),t.createElement(_,{style:s.header},"This server is locked!"),t.createElement(_,{style:s.text},"enter passcode to unlock"),t.createElement(U,{style:s.passcode,onSubmitEditing:w=>{w.nativeEvent.text==F(l(this.name,"passcode"),`${r[0]}${r[1]}${r[4]}`)?(y(this.name,m,!1),d.open({content:"Successfully unlocked!",source:G})):d.open({content:"Incorrect password. Try again.",source:p})},secureTextEntry:!0}),t.createElement(_,{style:s.footer},"K2geLocker"))}else return R}),b.instead(xe,"openLazy",(g,h,f)=>{let E=h[1];(E.startsWith("instant-invite")||E.startsWith("vanity-url-invite"))&&l(this.name,"inv_hijack")?l(this.name,n)?k.show({title:"K2geLocker",body:"This server is locked",confirmText:"Ok"}):k.show({title:"K2geLocker",body:"Select an action",confirmText:"Lock the Server",cancelText:"Open invite menu",onConfirm:()=>{l(this.name,"passcode")===void 0?d.open({content:"Please set passcode in plugin setting before you lock the server!",source:p}):(y(this.name,n,!0),d.open({content:"Successfully locked!",source:G}))},onCancel:()=>{f.apply(g,h)}}):f.apply(g,h)}),l(this.name,"check_updates")&&(l(this.name,"updating")?y(v,"updating",!1):z())},onStop(){this.commands=[],b.unpatchAll()},getSettingsPanel({settings:e}){return t.createElement(_e,{settings:e})}};ee(Ye);
