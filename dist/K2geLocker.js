const y=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const S=window.enmity.modules.common.Toasts,R=window.enmity.modules.common.Dialog;window.enmity.modules.common.Token;const W=window.enmity.modules.common.REST;window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const N=window.enmity.modules.common.Navigation,ue=window.enmity.modules.common.NavigationNative,J=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme;const K=window.enmity.modules.common.Linking,O=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;function ge(e){window.enmity.plugins.registerPlugin(e)}function he(e){return window.enmity.plugins.getPlugin(e)}const M={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,n)=>window.enmity.modules.filters.byName(e,n),byTypeName:(e,n)=>window.enmity.modules.filters.byTypeName(e,n),byDisplayName:(e,n)=>window.enmity.modules.filters.byDisplayName(e,n)};function we(e,n){return window.enmity.modules.getModule(e,n)}function Q(...e){return window.enmity.modules.bulk(...e)}window.enmity.modules.common;const{components:o}=window.enmity;o.Alert;const X=o.Button;o.FlatList;const U=o.Image;o.ImageBackground,o.KeyboardAvoidingView,o.Modal,o.Pressable,o.RefreshControl;const ye=o.ScrollView;o.SectionList,o.StatusBar,o.StyleSheet,o.Switch;const P=o.Text;o.TextInput,o.TouchableHighlight;const fe=o.TouchableOpacity;o.TouchableWithoutFeedback,o.Touchable;const b=o.View;o.VirtualizedList,o.Form,o.FormArrow,o.FormCTA,o.FormCTAButton,o.FormCardSection,o.FormCheckbox,o.FormDivider,o.FormHint,o.FormIcon,o.FormInput,o.FormLabel,o.FormRadio;const d=o.FormRow,q=o.FormSection;o.FormSelect,o.FormSubLabel;const $=o.FormSwitch;o.FormTernaryCheckBox,o.FormText,o.FormTextColors,o.FormTextSizes;function _(e,n,r){window.enmity.settings.set(e,n,r)}function m(e,n,r){return window.enmity.settings.get(e,n,r)}function Se(e){return window.enmity.patcher.create(e)}function l(e){return window.enmity.assets.getIDByName(e)}function Z(e,n,r){return window.enmity.utilities.findInReactTree(e,n,r)}var k="K2geLocker",be="1.2.1",ve="Lock the specific server with passcode.",_e=[{name:"mafu",id:"519760564755365888"}],Ee={name:k,version:be,description:ve,authors:_e};function H(e,n){let r="";for(let v=0;v<e.length;v++)r+=String.fromCharCode(e.charCodeAt(v)^n.charCodeAt(v%n.length));return r}const ke=we(e=>e._dispatcher._actionHandlers._dependencyGraph.nodes),j=ke._dispatcher._actionHandlers._dependencyGraph.nodes;function G(e){let n=Object.keys(j).filter(r=>j[r].name===e);if(n)return j[n[0]].actionHandler}const{native:B}=window.enmity;function ee(){B.reload()}B.version,B.build,B.device,B.version;const pe="https://github.com/m4fn3/K2geLocker",Le="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/manifest.json",Ie="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/dist/K2geLocker.js",Ce="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/changelogs.json";function Re(e,n){window.enmity.plugins.installPlugin(Ie,()=>{R.show({title:"K2geLocker",body:`Updated from ${e} to ${n}!
Do you want to reload Discord now?`,confirmText:"Yes",cancelText:"Later",onConfirm:()=>ee()})})}function te(e=!1){W.get(Le).then(n=>{const r=JSON.parse(n.text),v=he(r.name);r.version.localeCompare(v.version,void 0,{numeric:!0})===1?(e||!e&&m(k,"ignored")!=r.version)&&W.get(Ce).then(p=>{const L=JSON.parse(p.text);let a="";L[r.version]&&(a=`

- Changelogs
${L[r.version]}`),R.show({title:"K2geLocker",body:`New version v${r.version} is available!${a}`,confirmText:"Update",cancelText:"Ignore",onConfirm:()=>{_(k,"updating",!0),Re(v.version,r.version)},onCancel:()=>_(k,"ignored",r.version)})}):e&&R.show({title:"K2geLocker",body:`You are using latest version v${v.version}!`,confirmText:"OK"})}).catch(n=>{n.status===404&&R.show({title:"K2geLocker",body:"Failed to check for updates. Please check GitHub manually.",confirmText:"GitHub",cancelText:"Close",onConfirm:()=>K.openURL(pe)})})}const oe=J.createStackNavigator(),[Te]=Q(M.byProps("AppState")),x="Love K2ge3 lol";l("nsfw_gate_lock");const ne=l("img_nitro_star");l("ic_following");const Ne=l("ic_info_24px"),re=l("Small"),Me=l("ic_arrow_back_24px"),A=O.createThemedStyleSheet({container:{backgroundColor:y.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:y.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:y.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:y.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:y.ThemeColorMap.HEADER_PRIMARY},close:{color:y.ThemeColorMap.HEADER_PRIMARY}});function Y({callback:e=null,isSetup:n=!1,showClose:r=!0}){const v=Te.useWindowDimensions().width,p=Math.min(v,450);function L(){const a=O.createThemedStyleSheet({container:{flex:1,backgroundColor:y.ThemeColorMap.BACKGROUND_PRIMARY,alignSelf:"center",alignItems:"center",justifyContent:"center",width:p},title:{height:40},titleText:{color:y.ThemeColorMap.HEADER_PRIMARY,fontSize:30},circleBox:{flexDirection:"row",height:130,paddingTop:20},white_circle:{width:20,height:20,borderRadius:10,backgroundColor:"white",marginRight:10},gray_circle:{width:20,height:20,borderRadius:10,backgroundColor:"gray",marginRight:10},numberBox:{flexDirection:"row",flexWrap:"wrap",width:300},number:{width:100,height:70,alignItems:"center",justifyContent:"center"},numberText:{color:y.ThemeColorMap.HEADER_PRIMARY,fontSize:30}}),[T,D]=t.useState(""),[F,I]=t.useState(""),s=[a.gray_circle,a.gray_circle,a.gray_circle,a.gray_circle],[c,u]=t.useState(s);let f=n?"Enter new passcode":"Enter passcode ";return t.createElement(b,{style:a.container},t.createElement(b,{style:a.title},t.createElement(P,{style:a.titleText},f)),t.createElement(b,{style:a.circleBox},t.createElement(b,{style:c[0]}),t.createElement(b,{style:c[1]}),t.createElement(b,{style:c[2]}),t.createElement(b,{style:c[3]})),t.createElement(b,{style:a.numberBox},[1,2,3,4,5,6,7,8,9,"",0,"back"].map((w,g)=>w!==""?t.createElement(fe,{style:a.number,key:g,onPress:()=>{if(typeof w=="number"){let i=F+w.toString();I(i);let h=c;h[i.length-1]=a.white_circle,u(h),i.length===4&&setTimeout(()=>{if(!n)i===H(m(k,"passcode"),`${x[5]}${x[6]}${x[0]}`)?(N.pop(),e(),S.open({content:"Successfully unlocked!",source:ne})):(I(""),u(s),S.open({content:"Incorrect password. Try again.",source:re}));else if(!T)D(i),I(""),u(s),S.open({content:"Retype new passcode to confirm.",source:Ne});else{if(T===i){let C=H(T,`${x[5]}${x[6]}${x[0]}`);_(k,"passcode",C),S.open({content:"Successfully set new passcode!",source:ne})}else S.open({content:"Passcode didn't match.",source:re});N.pop()}},200)}else{let i=F.slice(0,-1);I(i);let h=c;h[i.length]=a.gray_circle,u(h)}}},typeof w=="number"?t.createElement(P,{style:a.numberText},w):t.createElement(U,{source:Me})):t.createElement(b,{style:a.number,key:g}))))}return t.createElement(ue.NavigationContainer,null,t.createElement(oe.Navigator,{initialRouteName:"K2geLocker",style:A.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:A.cardStyle,headerStyle:A.header,headerTitleContainerStyle:A.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},t.createElement(oe.Screen,{name:"K2geLocker",component:L,options:{headerTitleStyle:{color:"white"},headerLeft:()=>{if(r)return t.createElement(X,{color:A.close.color,title:"Close",onPress:()=>N.pop()})},...J.TransitionPresets.ModalSlideFromBottomIOS}})))}l("img_nitro_star");const Pe=l("Small"),xe=l("img_account_sync_github_white"),De=l("img_account_sync_twitter_white"),Be=l("ic_message_retry"),Ae=l("hub-invite"),Fe=l("ic_lock"),Oe=l("toast_image_saved"),Ge=l("ic_drag_icon_24px");var Ke=({settings:e})=>{const n=O.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:y.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:y.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"}});return t.createElement(ye,null,t.createElement(b,{style:n.container},t.createElement(U,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:n.image}),t.createElement(b,{style:n.title},t.createElement(P,{style:n.name},"K2geLocker"),t.createElement(P,{style:n.author},"by mafu"))),t.createElement(q,{title:"SETTINGS"},t.createElement(d,{label:"Setup Passcode",trailing:d.Arrow,leading:t.createElement(d.Icon,{source:Ge}),subLabel:"Open password setup modal",onPress:()=>{N.push(Y,{isSetup:!0})}}),t.createElement(d,{label:"Reload Discord",trailing:d.Arrow,leading:t.createElement(d.Icon,{source:Be}),subLabel:"Reloading is required in order to properly initialize K2geLocker after enabling plugin",onPress:()=>{ee()}}),t.createElement(d,{label:"Enable invitation menu hijacking",subLabel:"Useful for iPad on which can't long press icon. For servers with inv disabled, use /lock command.",leading:t.createElement(d.Icon,{source:Ae}),trailing:t.createElement($,{value:e.getBoolean("inv_hijack",!0),onValueChange:r=>{e.set("inv_hijack",r)}})}),t.createElement(d,{label:"Enable app-wide locking",subLabel:"You can lock entire app with passcode!",leading:t.createElement(d.Icon,{source:Fe}),trailing:t.createElement($,{value:e.getBoolean("lock_app",!1),onValueChange:r=>{r&&e.get("passcode")===void 0?(S.open({content:"Please set passcode in plugin setting first!",source:Pe}),r=!1):e.set("lock_app",r)}})}),t.createElement(d,{label:"Check for updates",subLabel:"Whether automatically check or not. You can tap here to check manually too.",leading:t.createElement(d.Icon,{source:Oe}),trailing:t.createElement($,{value:e.getBoolean("check_updates",!0),onValueChange:r=>{e.set("check_updates",r)}}),onPress:()=>{te(!0)}})),t.createElement(q,{title:"INFORMATION"},t.createElement(d,{label:"Twitter @m4fn3",style:n.info,trailing:d.Arrow,leading:t.createElement(d.Icon,{source:De}),onPress:()=>{K.openURL("https://twitter.com/m4fn3")}}),t.createElement(d,{label:"GitHub (m4fn3)",style:n.info,trailing:d.Arrow,leading:t.createElement(d.Icon,{source:xe}),onPress:()=>{K.openURL("https://github.com/m4fn3/K2geLocker")}})))},ie;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(ie||(ie={}));var z;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(z||(z={}));var se;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(se||(se={}));var le;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(le||(le={}));var ce;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number",e[e.Attachment=11]="Attachment"})(ce||(ce={}));var ae;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(ae||(ae={}));const Ue=l("img_nitro_star"),$e=l("Small"),He={id:"lock",name:"lock",displayName:"lock",description:"Lock the server with passcode",displayDescription:"Lock the server with passcode",type:z.Chat,execute:async function(e,n){m(k,"passcode")===void 0?S.open({content:"Please set passcode in plugin setting before you lock the server!",source:$e}):(_(k,n.guild.id,!0),S.open({content:"Successfully locked!",source:Ue}))}},E=Se("K2geLocker"),[je,Ye,ze,Ve,We]=Q(M.byName("MessagesConnected",!1),M.byProps("openLazy","hideActionSheet"),M.byProps("getLastSelectedGuildId"),M.byProps("getMostRecentSelectedTextChannelId"),M.byProps("_currentDispatchActionType","_subscriptions","_waitQueue")),[Je,Qe,de,Xe]=[G("AppStateStore"),G("DeveloperOptionsStore"),G("ModalDeprecatedStore"),G("GatewayConnectionStore")],qe=l("nsfw_gate_lock"),me=l("img_nitro_star"),V=l("Small"),Ze=l("ic_locked_24px"),et=l("ic_full_server_gating_24px");function tt(e,n){m("K2geLocker",e)===void 0&&_("K2geLocker",e,n)}const ot={...Ee,onStart(){this.commands=[He];let e=this.name;[["inv_hijack",!0],["check_updates",!0],["lock_app",!1]].forEach(s=>{tt(s[0],s[1])});function n(s){let c=Ve.getMostRecentSelectedTextChannelId(s);We.dispatch({type:"CHANNEL_SELECT",guildId:s,channelId:c,messageId:void 0,jumpType:"ANIMATED",preserveDrawerState:!1,source:void 0})}function r(s){N.push(Y,{callback:()=>{_(e,s,!1),n(s)}})}function v(){N.push(Y,{callback:()=>{p=!1},showClose:!1})}let p=!1,L=!0;E.before(Je,"APP_STATE_UPDATE",(s,c,u)=>{let f=c[0].state;m(e,"lock_app")&&!p&&(m(e,"passcode")===void 0?_(e,"lock_app",!1):(L||f=="background")&&(v(),p=!0,L=!1))});const a=E.after(b,"render",(s,c,u)=>{const f=Z(u,g=>{var i,h,C;return((i=g.props)==null?void 0:i.delayLongPress)==300&&((h=g.props)==null?void 0:h.onGuildSelected)===void 0&&((C=g.props)==null?void 0:C.guild)});if(f){E.before(f.type,"type",(g,i,h)=>{m(e,i[0].guild.id)?m(e,"passcode")===void 0?(_(e,i[0].guild.id,void 0),i[0].onGuildSelected=void 0):i[0].onGuildSelected=r:i[0].onGuildSelected=void 0});return}const w=Z(u,g=>{var i,h,C;return((i=g.props)==null?void 0:i.guildId)&&((h=g.props)==null?void 0:h.yPos)&&((C=g.props)==null?void 0:C.onClose)});!w||(E.after(w.type,"render",(g,i,h)=>(m(e,i[0].guildId)?h.props.rows=[{icon:et,text:"Unlock Server",onClick:()=>{r(i[0].guildId)}}]:h.props.rows.unshift({icon:Ze,text:"Lock Server",onClick:()=>{m(e,"passcode")===void 0?S.open({content:"Please set passcode in plugin setting before you lock the server!",source:V}):m(e,i[0].guildId)?S.open({content:"This server is already locked!",source:V}):(_(e,i[0].guildId,!0),S.open({content:"Successfully locked!",source:me}))}}),h)),a())});E.instead(je,"default",(s,c,u)=>{var f;let w=u.apply(s,c),g=(f=w==null?void 0:w.props)==null?void 0:f.guildId;if(g&&m(e,g)){const i=O.createThemedStyleSheet({container:{fontFamily:y.Fonts.PRIMARY_SEMIBOLD,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:y.ThemeColorMap.BACKGROUND_PRIMARY},image:{width:120,height:120,padding:5,marginBottom:30},header:{color:y.ThemeColorMap.HEADER_PRIMARY,fontWeight:"bold",fontSize:25,marginBottom:30},button:{fontSize:30},footer:{color:y.ThemeColorMap.HEADER_SECONDARY,fontSize:16,marginTop:80,marginBottom:70}});return t.createElement(b,{style:i.container},t.createElement(U,{style:i.image,source:qe}),t.createElement(P,{style:i.header},"This server is locked!"),t.createElement(X,{style:i.button,onPress:()=>r(g),title:"Unlock"}),t.createElement(P,{style:i.footer},"K2geLocker"))}else return w}),E.instead(Ye,"openLazy",(s,c,u)=>{let f=c[1];if((f.startsWith("instant-invite")||f.startsWith("vanity-url-invite"))&&m(e,"inv_hijack")){let w=ze.getLastSelectedGuildId();m(e,w)?R.show({title:"K2geLocker",body:"This server is locked",confirmText:"Ok"}):R.show({title:"K2geLocker",body:"Select an action",confirmText:"Lock the Server",cancelText:"Open invite menu",onConfirm:()=>{m(e,"passcode")===void 0?S.open({content:"Please set passcode in plugin setting before you lock the server!",source:V}):(_(e,w,!0),S.open({content:"Successfully locked!",source:me}))},onCancel:()=>{u.apply(s,c)}})}else u.apply(s,c)}),E.before(Qe,"LOGOUT",(s,c,u)=>{R.show({title:"K2geLocker",body:`Automatically disabled itself to prevent app from causing weird problems!
Please enable plugin manually after you re-login to the account.`,confirmText:"See you again!"}),this.commands=[],E.unpatchAll(),window.enmity.plugins.disablePlugin("K2geLocker")});let T=!1,D=[];E.before(Xe,"PUSH_NOTIFICATION_CLICK",(s,c,u)=>{T=!0,D=[]});const F=["MODAL_POP_ALL","CHANGE_LOG_CLOSE","CHANNEL_SETTINGS_CLOSE","GUILD_SETTINGS_CLOSE","EMAIL_VERIFICATION_MODAL_CLOSE","NOTIFICATION_SETTINGS_MODAL_CLOSE","SEARCH_MODAL_CLOSE","USER_SETTINGS_MODAL_CLOSE","MENTION_MODAL_CLOSE"];Object.keys(de).forEach(s=>{F.includes(s)&&E.instead(de,s,(c,u,f)=>{T&&!Object.keys(D).includes(s)?D[s]=!0:f.apply(c,u)})}),m(e,"check_updates")&&(m(e,"updating")?_(k,"updating",!1):te());let I=H(m(e,"passcode"),`${e[0]}${e[1]}${e[4]}`);isNaN(I)&&I!==void 0&&_(e,"passcode",void 0)},onStop(){this.commands=[],E.unpatchAll()},getSettingsPanel({settings:e}){return t.createElement(Ke,{settings:e})}};ge(ot);
