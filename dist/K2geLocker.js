const h=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const b=window.enmity.modules.common.Toasts,I=window.enmity.modules.common.Dialog;window.enmity.modules.common.Token;const ce=window.enmity.modules.common.REST;window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const C=window.enmity.modules.common.Navigation,ae=window.enmity.modules.common.NavigationNative,z=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme;const G=window.enmity.modules.common.Linking,K=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;function de(e){window.enmity.plugins.registerPlugin(e)}function me(e){return window.enmity.plugins.getPlugin(e)}const T={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,o)=>window.enmity.modules.filters.byName(e,o),byTypeName:(e,o)=>window.enmity.modules.filters.byTypeName(e,o),byDisplayName:(e,o)=>window.enmity.modules.filters.byDisplayName(e,o)};function ue(e,o){return window.enmity.modules.getModule(e,o)}function V(...e){return window.enmity.modules.bulk(...e)}window.enmity.modules.common;const{components:n}=window.enmity;n.Alert;const W=n.Button;n.FlatList;const A=n.Image;n.ImageBackground,n.KeyboardAvoidingView,n.Modal,n.Pressable,n.RefreshControl;const ge=n.ScrollView;n.SectionList,n.StatusBar,n.StyleSheet,n.Switch;const M=n.Text;n.TextInput,n.TouchableHighlight;const he=n.TouchableOpacity;n.TouchableWithoutFeedback,n.Touchable;const v=n.View;n.VirtualizedList,n.Form,n.FormArrow,n.FormCTA,n.FormCTAButton,n.FormCardSection,n.FormCheckbox,n.FormDivider,n.FormHint,n.FormIcon,n.FormInput,n.FormLabel,n.FormRadio;const c=n.FormRow,O=n.FormSection;n.FormSelect,n.FormSubLabel;const U=n.FormSwitch;n.FormTernaryCheckBox,n.FormText,n.FormTextColors,n.FormTextSizes;function k(e,o,r){window.enmity.settings.set(e,o,r)}function a(e,o,r){return window.enmity.settings.get(e,o,r)}function we(e){return window.enmity.patcher.create(e)}function s(e){return window.enmity.assets.getIDByName(e)}function q(e,o,r){return window.enmity.utilities.findInReactTree(e,o,r)}function ye(e,o,r){return window.enmity.utilities.findInTree(e,o,r)}var E="K2geLocker",fe="1.1.2",be="Lock the specific server with passcode.",ve=[{name:"mafu",id:"519760564755365888"}],Se={name:E,version:fe,description:be,authors:ve};function Y(e,o){let r="";for(let S=0;S<e.length;S++)r+=String.fromCharCode(e.charCodeAt(S)^o.charCodeAt(S%o.length));return r}const ke=ue(e=>e._dispatcher._actionHandlers._dependencyGraph.nodes),_e=ke._dispatcher._actionHandlers._dependencyGraph.nodes;function Ee(e){let o=ye(_e,r=>r.name===e);if(o)return o.actionHandler}const{native:B}=window.enmity;function J(){B.reload()}B.version,B.build,B.device,B.version;const pe="https://github.com/m4fn3/K2geLocker",Re="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/manifest.json",Le="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/dist/K2geLocker.js";function Ie(e,o){window.enmity.plugins.installPlugin(Le,()=>{I.show({title:"K2geLocker",body:`Updated from ${e} to ${o}!
Do you want to reload Discord now?`,confirmText:"Yes",cancelText:"Later",onConfirm:()=>J()})})}function Q(e=!1){ce.get(Re).then(o=>{const r=JSON.parse(o.text),S=me(r.name);r.version.localeCompare(S.version,void 0,{numeric:!0})===1?(e||!e&&a(E,"ignored")!=r.version)&&I.show({title:"K2geLocker",body:`New version v${r.version} is available!`,confirmText:"Update",cancelText:"Ignore",onConfirm:()=>{k(E,"updating",!0),Ie(S.version,r.version)},onCancel:()=>k(E,"ignored",r.version)}):e&&I.show({title:"K2geLocker",body:`You are using latest version v${S.version}!`,confirmText:"OK"})}).catch(o=>{o.status===404&&I.show({title:"K2geLocker",body:"Failed to check for updates. Please check GitHub manually.",confirmText:"GitHub",cancelText:"Close",onConfirm:()=>G.openURL(pe)})})}const X=z.createStackNavigator(),[Ce]=V(T.byProps("AppState")),x="Love K2ge3 lol";s("nsfw_gate_lock");const Z=s("img_nitro_star");s("ic_following");const Te=s("ic_info_24px"),ee=s("Small"),Me=s("ic_arrow_back_24px"),D=K.createThemedStyleSheet({container:{backgroundColor:h.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:h.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:h.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:h.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:h.ThemeColorMap.HEADER_PRIMARY},close:{color:h.ThemeColorMap.HEADER_PRIMARY}});function $({callback:e=null,isSetup:o=!1,showClose:r=!0}){const S=Ce.useWindowDimensions().width,P=Math.min(S,450);function F(){const m=K.createThemedStyleSheet({container:{flex:1,backgroundColor:h.ThemeColorMap.BACKGROUND_PRIMARY,alignSelf:"center",alignItems:"center",justifyContent:"center",width:P},title:{height:40},titleText:{color:h.ThemeColorMap.HEADER_PRIMARY,fontSize:30},circleBox:{flexDirection:"row",height:130,paddingTop:20},white_circle:{width:20,height:20,borderRadius:10,backgroundColor:"white",marginRight:10},gray_circle:{width:20,height:20,borderRadius:10,backgroundColor:"gray",marginRight:10},numberBox:{flexDirection:"row",flexWrap:"wrap",width:300},number:{width:100,height:70,alignItems:"center",justifyContent:"center"},numberText:{color:h.ThemeColorMap.HEADER_PRIMARY,fontSize:30}}),[L,d]=t.useState(""),[y,f]=t.useState(""),w=[m.gray_circle,m.gray_circle,m.gray_circle,m.gray_circle],[u,l]=t.useState(w);let i=o?"Enter new passcode":"Enter passcode ";return t.createElement(v,{style:m.container},t.createElement(v,{style:m.title},t.createElement(M,{style:m.titleText},i)),t.createElement(v,{style:m.circleBox},t.createElement(v,{style:u[0]}),t.createElement(v,{style:u[1]}),t.createElement(v,{style:u[2]}),t.createElement(v,{style:u[3]})),t.createElement(v,{style:m.numberBox},[1,2,3,4,5,6,7,8,9,"",0,"back"].map((g,p)=>g!==""?t.createElement(he,{style:m.number,key:p,onPress:()=>{if(typeof g=="number"){let _=y+g.toString();f(_);let N=u;N[_.length-1]=m.white_circle,l(N),_.length===4&&setTimeout(()=>{if(!o)_===Y(a(E,"passcode"),`${x[5]}${x[6]}${x[0]}`)?(C.pop(),e(),b.open({content:"Successfully unlocked!",source:Z})):(f(""),l(w),b.open({content:"Incorrect password. Try again.",source:ee}));else if(!L)d(_),f(""),l(w),b.open({content:"Retype new passcode to confirm.",source:Te});else{if(L===_){let le=Y(L,`${x[5]}${x[6]}${x[0]}`);k(E,"passcode",le),b.open({content:"Successfully set new passcode!",source:Z})}else b.open({content:"Passcode didn't match.",source:ee});C.pop()}},200)}else{let _=y.slice(0,-1);f(_);let N=u;N[_.length]=m.gray_circle,l(N)}}},typeof g=="number"?t.createElement(M,{style:m.numberText},g):t.createElement(A,{source:Me})):t.createElement(v,{style:m.number,key:p}))))}return t.createElement(ae.NavigationContainer,null,t.createElement(X.Navigator,{initialRouteName:"K2geLocker",style:D.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:D.cardStyle,headerStyle:D.header,headerTitleContainerStyle:D.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},t.createElement(X.Screen,{name:"K2geLocker",component:F,options:{headerTitleStyle:{color:"white"},headerLeft:()=>{if(r)return t.createElement(W,{color:D.close.color,title:"Close",onPress:()=>C.pop()})},...z.TransitionPresets.ModalSlideFromBottomIOS}})))}s("img_nitro_star");const xe=s("Small"),Pe=s("img_account_sync_github_white"),Ne=s("img_account_sync_twitter_white"),Be=s("ic_message_retry"),De=s("hub-invite"),Fe=s("ic_lock"),Ke=s("toast_image_saved"),Ge=s("ic_drag_icon_24px");var Ae=({settings:e})=>{const o=K.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:h.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:h.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"}});return t.createElement(ge,null,t.createElement(v,{style:o.container},t.createElement(A,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:o.image}),t.createElement(v,{style:o.title},t.createElement(M,{style:o.name},"K2geLocker"),t.createElement(M,{style:o.author},"by mafu"))),t.createElement(O,{title:"SETTINGS"},t.createElement(c,{label:"Setup Passcode",trailing:c.Arrow,leading:t.createElement(c.Icon,{source:Ge}),subLabel:"Open password setup modal",onPress:()=>{C.push($,{isSetup:!0})}}),t.createElement(c,{label:"Reload Discord",trailing:c.Arrow,leading:t.createElement(c.Icon,{source:Be}),subLabel:"Reloading is required in order to properly initialize K2geLocker after enabling plugin",onPress:()=>{J()}}),t.createElement(c,{label:"Enable invitation menu hijacking",subLabel:"Useful for iPad on which can't long press icon. For servers with inv disabled, use /lock command.",leading:t.createElement(c.Icon,{source:De}),trailing:t.createElement(U,{value:e.getBoolean("inv_hijack",!0),onValueChange:r=>{e.set("inv_hijack",r)}})}),t.createElement(c,{label:"Enable app-wide locking",subLabel:"You can lock entire app with passcode!",leading:t.createElement(c.Icon,{source:Fe}),trailing:t.createElement(U,{value:e.getBoolean("lock_app",!1),onValueChange:r=>{r&&e.get("passcode")===void 0?(b.open({content:"Please set passcode in plugin setting first!",source:xe}),r=!1):e.set("lock_app",r)}})}),t.createElement(c,{label:"Check for updates",subLabel:"Whether automatically check or not. You can tap here to check manually too.",leading:t.createElement(c.Icon,{source:Ke}),trailing:t.createElement(U,{value:e.getBoolean("check_updates",!0),onValueChange:r=>{e.set("check_updates",r)}}),onPress:()=>{Q(!0)}})),t.createElement(O,{title:"INFORMATION"},t.createElement(c,{label:"Twitter @m4fn3",style:o.info,trailing:c.Arrow,leading:t.createElement(c.Icon,{source:Ne}),onPress:()=>{G.openURL("https://twitter.com/m4fn3")}}),t.createElement(c,{label:"GitHub (m4fn3)",style:o.info,trailing:c.Arrow,leading:t.createElement(c.Icon,{source:Pe}),onPress:()=>{G.openURL("https://github.com/m4fn3/K2geLocker")}})))},te;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(te||(te={}));var H;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(H||(H={}));var oe;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(oe||(oe={}));var ne;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(ne||(ne={}));var re;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number",e[e.Attachment=11]="Attachment"})(re||(re={}));var ie;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(ie||(ie={}));const Ue=s("img_nitro_star"),Ye=s("Small"),$e={id:"lock",name:"lock",displayName:"lock",description:"Lock the server with passcode",displayDescription:"Lock the server with passcode",type:H.Chat,execute:async function(e,o){a(E,"passcode")===void 0?b.open({content:"Please set passcode in plugin setting before you lock the server!",source:Ye}):(k(E,o.guild.id,!0),b.open({content:"Successfully locked!",source:Ue}))}},R=we("K2geLocker"),[He,je,ze,Ve,We]=V(T.byName("MessagesConnected",!1),T.byProps("openLazy","hideActionSheet"),T.byProps("getLastSelectedGuildId"),T.byProps("getMostRecentSelectedTextChannelId"),T.byProps("_currentDispatchActionType","_subscriptions","_waitQueue")),Oe=s("nsfw_gate_lock"),se=s("img_nitro_star"),j=s("Small"),qe=s("ic_locked_24px"),Je=s("ic_full_server_gating_24px");function Qe(e,o){a("K2geLocker",e)===void 0&&k("K2geLocker",e,o)}const Xe={...Se,onStart(){this.commands=[$e];let e=this.name;[["inv_hijack",!0],["check_updates",!0],["lock_app",!1]].forEach(d=>{Qe(d[0],d[1])});function o(d){let y=Ve.getMostRecentSelectedTextChannelId(d);We.dispatch({type:"CHANNEL_SELECT",guildId:d,channelId:y,messageId:void 0,jumpType:"ANIMATED",preserveDrawerState:!1,source:void 0})}function r(d){C.push($,{callback:()=>{k(e,d,!1),o(d)}})}function S(){C.push($,{callback:()=>{P=!1},showClose:!1})}let P=!1,F=!0;R.before(Ee("AppStateStore"),"APP_STATE_UPDATE",(d,y,f)=>{let w=y[0].state;a(e,"lock_app")&&!P&&(a(e,"passcode")===void 0?k(e,"lock_app",!1):(F||w=="background")&&(S(),P=!0,F=!1))});const m=R.after(v,"render",(d,y,f)=>{const w=q(f,l=>{var i,g,p;return((i=l.props)==null?void 0:i.delayLongPress)==300&&((g=l.props)==null?void 0:g.onGuildSelected)===void 0&&((p=l.props)==null?void 0:p.guild)});if(w){R.before(w.type,"type",(l,i,g)=>{a(e,i[0].guild.id)?a(e,"passcode")===void 0?(k(e,i[0].guild.id,void 0),i[0].onGuildSelected=void 0):i[0].onGuildSelected=r:i[0].onGuildSelected=void 0});return}const u=q(f,l=>{var i,g,p;return((i=l.props)==null?void 0:i.guildId)&&((g=l.props)==null?void 0:g.yPos)&&((p=l.props)==null?void 0:p.onClose)});!u||(R.after(u.type,"render",(l,i,g)=>(a(e,i[0].guildId)?g.props.rows=[{icon:Je,text:"Unlock Server",onClick:()=>{r(i[0].guildId)}}]:g.props.rows.unshift({icon:qe,text:"Lock Server",onClick:()=>{a(e,"passcode")===void 0?b.open({content:"Please set passcode in plugin setting before you lock the server!",source:j}):a(e,i[0].guildId)?b.open({content:"This server is already locked!",source:j}):(k(e,i[0].guildId,!0),b.open({content:"Successfully locked!",source:se}))}}),g)),m())});R.instead(He,"default",(d,y,f)=>{var w;let u=f.apply(d,y),l=(w=u==null?void 0:u.props)==null?void 0:w.guildId;if(l&&a(e,l)){const i=K.createThemedStyleSheet({container:{fontFamily:h.Fonts.PRIMARY_SEMIBOLD,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:h.ThemeColorMap.BACKGROUND_PRIMARY},image:{width:120,height:120,padding:5,marginBottom:30},header:{color:h.ThemeColorMap.HEADER_PRIMARY,fontWeight:"bold",fontSize:25,marginBottom:30},button:{fontSize:30},footer:{color:h.ThemeColorMap.HEADER_SECONDARY,fontSize:16,marginTop:80,marginBottom:70}});return t.createElement(v,{style:i.container},t.createElement(A,{style:i.image,source:Oe}),t.createElement(M,{style:i.header},"This server is locked!"),t.createElement(W,{style:i.button,onPress:()=>r(l),title:"Unlock"}),t.createElement(M,{style:i.footer},"K2geLocker"))}else return u}),R.instead(je,"openLazy",(d,y,f)=>{let w=y[1];if((w.startsWith("instant-invite")||w.startsWith("vanity-url-invite"))&&a(e,"inv_hijack")){let u=ze.getLastSelectedGuildId();a(e,u)?I.show({title:"K2geLocker",body:"This server is locked",confirmText:"Ok"}):I.show({title:"K2geLocker",body:"Select an action",confirmText:"Lock the Server",cancelText:"Open invite menu",onConfirm:()=>{a(e,"passcode")===void 0?b.open({content:"Please set passcode in plugin setting before you lock the server!",source:j}):(k(e,u,!0),b.open({content:"Successfully locked!",source:se}))},onCancel:()=>{f.apply(d,y)}})}else f.apply(d,y)}),a(e,"check_updates")&&(a(e,"updating")?k(E,"updating",!1):Q());let L=Y(a(e,"passcode"),`${e[0]}${e[1]}${e[4]}`);isNaN(L)&&L!==void 0&&k(e,"passcode",void 0)},onStop(){this.commands=[],R.unpatchAll()},getSettingsPanel({settings:e}){return t.createElement(Ae,{settings:e})}};de(Xe);
