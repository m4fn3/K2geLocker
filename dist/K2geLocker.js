const s=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const o=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const u=window.enmity.modules.common.Toasts,k=window.enmity.modules.common.Dialog;window.enmity.modules.common.Token;const J=window.enmity.modules.common.REST;window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const M=window.enmity.modules.common.Navigation,X=window.enmity.modules.common.NavigationNative,K=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme;const D=window.enmity.modules.common.Linking,p=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;function Z(e){window.enmity.plugins.registerPlugin(e)}function ee(e){return window.enmity.plugins.getPlugin(e)}const C={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,n)=>window.enmity.modules.filters.byName(e,n),byTypeName:(e,n)=>window.enmity.modules.filters.byTypeName(e,n),byDisplayName:(e,n)=>window.enmity.modules.filters.byDisplayName(e,n)};function te(...e){return window.enmity.modules.bulk(...e)}window.enmity.modules.common;const{components:t}=window.enmity;t.Alert;const oe=t.Button;t.FlatList;const N=t.Image;t.ImageBackground,t.KeyboardAvoidingView,t.Modal,t.Pressable,t.RefreshControl;const ne=t.ScrollView;t.SectionList,t.StatusBar,t.StyleSheet,t.Switch;const b=t.Text,Y=t.TextInput;t.TouchableHighlight,t.TouchableOpacity,t.TouchableWithoutFeedback,t.Touchable;const I=t.View;t.VirtualizedList,t.Form,t.FormArrow,t.FormCTA,t.FormCTAButton,t.FormCardSection,t.FormCheckbox,t.FormDivider,t.FormHint,t.FormIcon;const re=t.FormInput;t.FormLabel,t.FormRadio;const g=t.FormRow,H=t.FormSection;t.FormSelect,t.FormSubLabel;const U=t.FormSwitch;t.FormTernaryCheckBox,t.FormText,t.FormTextColors,t.FormTextSizes;function f(e,n,r){window.enmity.settings.set(e,n,r)}function m(e,n,r){return window.enmity.settings.get(e,n,r)}function se(e){return window.enmity.patcher.create(e)}function c(e){return window.enmity.assets.getIDByName(e)}var v="K2geLocker",ie="1.1.1",le="Lock the specific server with passcode.",ce=[{name:"mafu",id:"519760564755365888"}],ae={name:v,version:ie,description:le,authors:ce};function x(e,n){let r="";for(let l=0;l<e.length;l++)r+=String.fromCharCode(e.charCodeAt(l)^n.charCodeAt(l%n.length));return r}const{native:L}=window.enmity;function $(){L.reload()}L.version,L.build,L.device,L.version;const me="https://github.com/m4fn3/K2geLocker",de="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/manifest.json",ue="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/dist/K2geLocker.js";function ge(e,n){window.enmity.plugins.installPlugin(ue,()=>{k.show({title:"K2geLocker",body:`Updated from ${e} to ${n}!
Do you want to reload Discord now?`,confirmText:"Yes",cancelText:"Later",onConfirm:()=>$()})})}function G(e=!1){J.get(de).then(n=>{const r=JSON.parse(n.text),l=ee(r.name);r.version.localeCompare(l.version,void 0,{numeric:!0})===1?(e||!e&&m(v,"ignored")!=r.version)&&k.show({title:"K2geLocker",body:`New version v${r.version} is available!`,confirmText:"Update",cancelText:"Ignore",onConfirm:()=>{f(v,"updating",!0),ge(l.version,r.version)},onCancel:()=>f(v,"ignored",r.version)}):e&&k.show({title:"K2geLocker",body:`You are using latest version v${l.version}!`,confirmText:"OK"})}).catch(n=>{n.status===404&&k.show({title:"K2geLocker",body:"Failed to check for updates. Please check GitHub manually.",confirmText:"GitHub",cancelText:"Close",onConfirm:()=>D.openURL(me)})})}const B="Love K2ge3 lol",he=c("img_nitro_star"),we=c("Small"),ye=c("img_account_sync_github_white"),fe=c("img_account_sync_twitter_white"),ve=c("ic_message_retry"),Se=c("hub-invite");c("debug");const Ee=c("toast_image_saved");var be=({settings:e})=>{const n=p.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:s.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:s.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"}});return o.createElement(ne,null,o.createElement(I,{style:n.container},o.createElement(N,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:n.image}),o.createElement(I,{style:n.title},o.createElement(b,{style:n.name},"K2geLocker"),o.createElement(b,{style:n.author},"by mafu"))),o.createElement(H,{title:"SETTINGS"},o.createElement(re,{value:e.get("passcode"),title:"Passcode",placeholder:"input your custom passcode here!",onSubmitEditing:r=>{if(r.nativeEvent.text=="")u.open({content:"Please enter your custom passcode",source:we});else{let l=x(r.nativeEvent.text,`${B[5]}${B[6]}${B[0]}`);e.set("passcode",l),u.open({content:"Successfully set new passcode!",source:he})}},secureTextEntry:!0}),o.createElement(g,{label:"Reload Discord",trailing:g.Arrow,leading:o.createElement(g.Icon,{source:ve}),subLabel:"Reloading is required in order to properly initialize K2geLocker after enabling plugin",onPress:()=>{$()}}),o.createElement(g,{label:"Enable invitation menu hijacking",subLabel:"Useful for iPad on which can't long press icon. For servers with inv disabled, use /lock command.",leading:o.createElement(g.Icon,{source:Se}),trailing:o.createElement(U,{value:e.getBoolean("inv_hijack",!0),onValueChange:r=>{e.set("inv_hijack",r)}})}),o.createElement(g,{label:"Check for updates",subLabel:"Whether automatically check or not. You can tap here to check manually too.",leading:o.createElement(g.Icon,{source:Ee}),trailing:o.createElement(U,{value:e.getBoolean("check_updates",!0),onValueChange:r=>{e.set("check_updates",r)}}),onPress:()=>{G(!0)}})),o.createElement(H,{title:"INFORMATION"},o.createElement(g,{label:"GitHub (m4fn3)",style:n.info,trailing:g.Arrow,leading:o.createElement(g.Icon,{source:ye}),onPress:()=>{D.openURL("https://github.com/m4fn3/K2geLocker")}}),o.createElement(g,{label:"Twitter @m4fn3",style:n.info,trailing:g.Arrow,leading:o.createElement(g.Icon,{source:fe}),onPress:()=>{D.openURL("https://twitter.com/m4fn3")}})))},j;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(j||(j={}));var P;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(P||(P={}));var z;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(z||(z={}));var O;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(O||(O={}));var V;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number",e[e.Attachment=11]="Attachment"})(V||(V={}));var W;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(W||(W={}));const ke=c("img_nitro_star"),Re=c("Small"),_e={id:"lock",name:"lock",displayName:"lock",description:"Lock the server with passcode",displayDescription:"Lock the server with passcode",type:P.Chat,execute:async function(e,n){m(v,"passcode")===void 0?u.open({content:"Please set passcode in plugin setting before you lock the server!",source:Re}):(f(v,n.guild.id,!0),u.open({content:"Successfully locked!",source:ke}))}},Q=K.createStackNavigator(),F="Love K2ge3 lol",Ce=c("nsfw_gate_lock"),Ie=c("img_nitro_star"),Le=c("Small");var pe=({guildId:e,fn:n})=>{function r(){const a=p.createThemedStyleSheet({container:{fontFamily:s.Fonts.PRIMARY_SEMIBOLD,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:s.ThemeColorMap.BACKGROUND_PRIMARY},image:{width:120,height:120,padding:5,marginBottom:30},header:{color:s.ThemeColorMap.HEADER_PRIMARY,fontWeight:"bold",fontSize:25},text:{color:s.ThemeColorMap.HEADER_SECONDARY,fontSize:16},passcode:{width:100,height:20,marginTop:30,borderWidth:1,borderColor:s.ThemeColorMap.HEADER_SECONDARY,backgroundColor:s.ThemeColorMap.HEADER_SECONDARY},footer:{color:s.ThemeColorMap.HEADER_SECONDARY,fontSize:16,marginTop:100,marginBottom:70}});return o.createElement(I,{style:a.container},o.createElement(N,{style:a.image,source:Ce}),o.createElement(b,{style:a.header},"This server is locked!"),o.createElement(b,{style:a.text},"enter passcode to unlock"),o.createElement(Y,{style:a.passcode,onSubmitEditing:w=>{if(w.nativeEvent.text==x(m(v,"passcode"),`${F[5]}${F[6]}${F[0]}`)){f(v,e,!1),n(e);let y="Successfully unlocked!";m(v,"no_auto_refresh")&&(y="Now, long press on server icon to apply unlocking!"),u.open({content:y,source:Ie}),M.pop()}else u.open({content:"Incorrect password. Try again.",source:Le})},secureTextEntry:!0}),o.createElement(b,{style:a.footer},"K2geLocker"))}const l=p.createThemedStyleSheet({container:{backgroundColor:s.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:s.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:s.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:s.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:s.ThemeColorMap.HEADER_PRIMARY},close:{color:s.ThemeColorMap.HEADER_PRIMARY}});return o.createElement(X.NavigationContainer,null,o.createElement(Q.Navigator,{initialRouteName:"K2egeLocker",style:l.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:l.cardStyle,headerStyle:l.header,headerTitleContainerStyle:l.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},o.createElement(Q.Screen,{name:"K2geLocker",component:r,options:{headerTitleStyle:{color:"white"},headerLeft:()=>o.createElement(oe,{color:l.close.color,title:"Close",onPress:()=>M.pop()}),...K.TransitionPresets.ModalSlideFromBottomIOS}})))};function q(e,n,r){return window.enmity.utilities.findInReactTree(e,n,r)}const R=se("K2geLocker"),[Te,Me,De,Ne,xe]=te(C.byName("MessagesConnected",!1),C.byProps("openLazy","hideActionSheet"),C.byProps("getLastSelectedGuildId"),C.byProps("getMostRecentSelectedTextChannelId"),C.byProps("_currentDispatchActionType","_subscriptions","_waitQueue")),Be=c("nsfw_gate_lock"),A=c("img_nitro_star"),T=c("Small"),Pe=c("ic_locked_24px"),Fe=c("ic_full_server_gating_24px"),Ae={...ae,onStart(){this.commands=[_e];let e=this.name;m(this.name,"inv_hijack")===void 0&&f(this.name,"inv_hijack",!0),m(this.name,"check_updates")===void 0&&f(this.name,"check_updates",!0);function n(a){let w=Ne.getMostRecentSelectedTextChannelId(a);xe.dispatch({type:"CHANNEL_SELECT",guildId:a,channelId:w,messageId:void 0,jumpType:"ANIMATED",preserveDrawerState:!1,source:void 0})}function r(a){M.push(pe,{guildId:a,fn:n})}const l=R.after(I,"render",(a,w,y)=>{const E=q(y,d=>{var i,h,_;return((i=d.props)==null?void 0:i.delayLongPress)==300&&((h=d.props)==null?void 0:h.onGuildSelected)===void 0&&((_=d.props)==null?void 0:_.guild)});if(E){R.before(E.type,"type",(d,i,h)=>{m(this.name,i[0].guild.id)?i[0].onGuildSelected=r:i[0].onGuildSelected=void 0});return}const S=q(y,d=>{var i,h,_;return((i=d.props)==null?void 0:i.guildId)&&((h=d.props)==null?void 0:h.yPos)&&((_=d.props)==null?void 0:_.onClose)});!S||(R.after(S.type,"render",(d,i,h)=>(m(this.name,i[0].guildId)?h.props.rows=[{icon:Fe,text:"Unlock Server",onClick:()=>{r(i[0].guildId)}}]:h.props.rows.unshift({icon:Pe,text:"Lock Server",onClick:()=>{m(this.name,"passcode")===void 0?u.open({content:"Please set passcode in plugin setting before you lock the server!",source:T}):m(this.name,i[0].guildId)?u.open({content:"This server is already locked!",source:T}):(f(this.name,i[0].guildId,!0),u.open({content:"Successfully locked!",source:A}))}}),h)),l())});R.instead(Te,"default",(a,w,y)=>{var E;let S=y.apply(a,w),d=(E=S==null?void 0:S.props)==null?void 0:E.guildId;if(d&&m(this.name,d)){const i=p.createThemedStyleSheet({container:{fontFamily:s.Fonts.PRIMARY_SEMIBOLD,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:s.ThemeColorMap.BACKGROUND_PRIMARY},image:{width:120,height:120,padding:5,marginBottom:30},header:{color:s.ThemeColorMap.HEADER_PRIMARY,fontWeight:"bold",fontSize:25},text:{color:s.ThemeColorMap.HEADER_SECONDARY,fontSize:16},passcode:{width:100,height:20,marginTop:30,borderWidth:1,borderColor:s.ThemeColorMap.HEADER_SECONDARY,backgroundColor:s.ThemeColorMap.HEADER_SECONDARY},footer:{color:s.ThemeColorMap.HEADER_SECONDARY,fontSize:16,marginTop:100,marginBottom:70}});return o.createElement(I,{style:i.container},o.createElement(N,{style:i.image,source:Be}),o.createElement(b,{style:i.header},"This server is locked!"),o.createElement(b,{style:i.text},"enter passcode to unlock"),o.createElement(Y,{style:i.passcode,onSubmitEditing:h=>{h.nativeEvent.text==x(m(this.name,"passcode"),`${e[0]}${e[1]}${e[4]}`)?(f(this.name,d,!1),u.open({content:"Successfully unlocked!",source:A})):u.open({content:"Incorrect password. Try again.",source:T})},secureTextEntry:!0}),o.createElement(b,{style:i.footer},"K2geLocker"))}else return S}),R.instead(Me,"openLazy",(a,w,y)=>{let E=w[1];if((E.startsWith("instant-invite")||E.startsWith("vanity-url-invite"))&&m(this.name,"inv_hijack")){let S=De.getLastSelectedGuildId();m(this.name,S)?k.show({title:"K2geLocker",body:"This server is locked",confirmText:"Ok"}):k.show({title:"K2geLocker",body:"Select an action",confirmText:"Lock the Server",cancelText:"Open invite menu",onConfirm:()=>{m(this.name,"passcode")===void 0?u.open({content:"Please set passcode in plugin setting before you lock the server!",source:T}):(f(this.name,S,!0),u.open({content:"Successfully locked!",source:A}))},onCancel:()=>{y.apply(a,w)}})}else y.apply(a,w)}),m(this.name,"check_updates")&&(m(this.name,"updating")?f(v,"updating",!1):G())},onStop(){this.commands=[],R.unpatchAll()},getSettingsPanel({settings:e}){return o.createElement(be,{settings:e})}};Z(Ae);
