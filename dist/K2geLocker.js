const i=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const u=window.enmity.modules.common.Toasts,b=window.enmity.modules.common.Dialog;window.enmity.modules.common.Token;const X=window.enmity.modules.common.REST;window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const T=window.enmity.modules.common.Navigation,Q=window.enmity.modules.common.NavigationNative,G=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme;const M=window.enmity.modules.common.Linking,I=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;function Z(e){window.enmity.plugins.registerPlugin(e)}function ee(e){return window.enmity.plugins.getPlugin(e)}const D={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,n)=>window.enmity.modules.filters.byName(e,n),byTypeName:(e,n)=>window.enmity.modules.filters.byTypeName(e,n),byDisplayName:(e,n)=>window.enmity.modules.filters.byDisplayName(e,n)};function oe(...e){return window.enmity.modules.bulk(...e)}window.enmity.modules.common;const{components:o}=window.enmity;o.Alert;const te=o.Button;o.FlatList;const x=o.Image;o.ImageBackground,o.KeyboardAvoidingView,o.Modal,o.Pressable,o.RefreshControl;const ne=o.ScrollView;o.SectionList,o.StatusBar,o.StyleSheet,o.Switch;const k=o.Text,H=o.TextInput;o.TouchableHighlight,o.TouchableOpacity,o.TouchableWithoutFeedback,o.Touchable;const L=o.View;o.VirtualizedList,o.Form,o.FormArrow,o.FormCTA,o.FormCTAButton,o.FormCardSection,o.FormCheckbox,o.FormDivider,o.FormHint,o.FormIcon;const re=o.FormInput;o.FormLabel,o.FormRadio;const g=o.FormRow,U=o.FormSection;o.FormSelect,o.FormSubLabel;const N=o.FormSwitch;o.FormTernaryCheckBox,o.FormText,o.FormTextColors,o.FormTextSizes;function f(e,n,r){window.enmity.settings.set(e,n,r)}function a(e,n,r){return window.enmity.settings.get(e,n,r)}function ie(e){return window.enmity.patcher.create(e)}function c(e){return window.enmity.assets.getIDByName(e)}var v="K2geLocker",se="1.1.1",ae="Lock the specific server with passcode.",le=[{name:"mafu",id:"519760564755365888"}],ce={name:v,version:se,description:ae,authors:le};function B(e,n){let r="";for(let l=0;l<e.length;l++)r+=String.fromCharCode(e.charCodeAt(l)^n.charCodeAt(l%n.length));return r}const{native:p}=window.enmity;function F(){p.reload()}p.version,p.build,p.device,p.version;const me="https://github.com/m4fn3/K2geLocker",de="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/manifest.json",ue="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/dist/K2geLocker.js";function ge(e,n){window.enmity.plugins.installPlugin(ue,()=>{b.show({title:"K2geLocker",body:`Updated from ${e} to ${n}!
Do you want to reload Discord now?`,confirmText:"Yes",cancelText:"Later",onConfirm:()=>F()})})}function $(e=!1){X.get(de).then(n=>{const r=JSON.parse(n.text),l=ee(r.name);r.version.localeCompare(l.version,void 0,{numeric:!0})===1?(e||!e&&a(v,"ignored")!=r.version)&&b.show({title:"K2geLocker",body:`New version v${r.version} is available!`,confirmText:"Update",cancelText:"Ignore",onConfirm:()=>{f(v,"updating",!0),ge(l.version,r.version)},onCancel:()=>f(v,"ignored",r.version)}):e&&b.show({title:"K2geLocker",body:`You are using latest version v${l.version}!`,confirmText:"OK"})}).catch(n=>{n.status===404&&b.show({title:"K2geLocker",body:"Failed to check for updates. Please check GitHub manually.",confirmText:"GitHub",cancelText:"Close",onConfirm:()=>M.openURL(me)})})}const P="Love K2ge3 lol",he=c("img_nitro_star"),we=c("Small"),fe=c("img_account_sync_github_white"),ye=c("img_account_sync_twitter_white"),ve=c("ic_message_retry"),Ee=c("hub-invite"),Se=c("debug"),be=c("toast_image_saved");var ke=({settings:e})=>{const n=I.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:i.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:i.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"}});return t.createElement(ne,null,t.createElement(L,{style:n.container},t.createElement(x,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:n.image}),t.createElement(L,{style:n.title},t.createElement(k,{style:n.name},"K2geLocker"),t.createElement(k,{style:n.author},"by mafu"))),t.createElement(U,{title:"SETTINGS"},t.createElement(re,{value:e.get("passcode"),title:"Passcode",placeholder:"input your custom passcode here!",onSubmitEditing:r=>{if(r.nativeEvent.text=="")u.open({content:"Please enter your custom passcode",source:we});else{let l=B(r.nativeEvent.text,`${P[5]}${P[6]}${P[0]}`);e.set("passcode",l),u.open({content:"Successfully set new passcode!",source:he})}},secureTextEntry:!0}),t.createElement(g,{label:"Reload Discord",trailing:g.Arrow,leading:t.createElement(g.Icon,{source:ve}),subLabel:"Reloading is required in order to properly initialize K2geLocker after enabling plugin",onPress:()=>{F()}}),t.createElement(g,{label:"Enable invitation menu hijacking",subLabel:"Useful for iPad on which can't long press icon. For servers with inv disabled, use /lock command.",leading:t.createElement(g.Icon,{source:Ee}),trailing:t.createElement(N,{value:e.getBoolean("inv_hijack",!0),onValueChange:r=>{e.set("inv_hijack",r)}})}),t.createElement(g,{label:"Check for updates",subLabel:"Whether automatically check or not. You can tap here to check manually too.",leading:t.createElement(g.Icon,{source:be}),trailing:t.createElement(N,{value:e.getBoolean("check_updates",!0),onValueChange:r=>{e.set("check_updates",r)}}),onPress:()=>{$(!0)}}),t.createElement(g,{label:"Disable auto refreshing",subLabel:"Fix bugs on left bar, but an additional action is needed after unlocking.",leading:t.createElement(g.Icon,{source:Se}),trailing:t.createElement(N,{value:e.getBoolean("no_auto_refresh",!1),onValueChange:r=>{e.set("no_auto_refresh",r),b.show({title:"Reload",body:`Reloading is required to apply changes.
Do you want to reload Discord now?`,confirmText:"Yes",cancelText:"Later",onConfirm:()=>{F()}})}})})),t.createElement(U,{title:"INFORMATION"},t.createElement(g,{label:"GitHub (m4fn3)",style:n.info,trailing:g.Arrow,leading:t.createElement(g.Icon,{source:fe}),onPress:()=>{M.openURL("https://github.com/m4fn3/K2geLocker")}}),t.createElement(g,{label:"Twitter @m4fn3",style:n.info,trailing:g.Arrow,leading:t.createElement(g.Icon,{source:ye}),onPress:()=>{M.openURL("https://twitter.com/m4fn3")}})))},z;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(z||(z={}));var K;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(K||(K={}));var O;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(O||(O={}));var j;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(j||(j={}));var V;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number",e[e.Attachment=11]="Attachment"})(V||(V={}));var W;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(W||(W={}));const _e=c("img_nitro_star"),Re=c("Small"),Ce={id:"lock",name:"lock",displayName:"lock",description:"Lock the server with passcode",displayDescription:"Lock the server with passcode",type:K.Chat,execute:async function(e,n){a(v,"passcode")===void 0?u.open({content:"Please set passcode in plugin setting before you lock the server!",source:Re}):(f(v,n.guild.id,!0),u.open({content:"Successfully locked!",source:_e}))}},q=G.createStackNavigator(),Y="Love K2ge3 lol",Le=c("nsfw_gate_lock"),pe=c("img_nitro_star"),Ie=c("Small");var De=({guildId:e,fn:n})=>{function r(){const m=I.createThemedStyleSheet({container:{fontFamily:i.Fonts.PRIMARY_SEMIBOLD,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:i.ThemeColorMap.BACKGROUND_PRIMARY},image:{width:120,height:120,padding:5,marginBottom:30},header:{color:i.ThemeColorMap.HEADER_PRIMARY,fontWeight:"bold",fontSize:25},text:{color:i.ThemeColorMap.HEADER_SECONDARY,fontSize:16},passcode:{width:100,height:20,marginTop:30,borderWidth:1,borderColor:i.ThemeColorMap.HEADER_SECONDARY,backgroundColor:i.ThemeColorMap.HEADER_SECONDARY},footer:{color:i.ThemeColorMap.HEADER_SECONDARY,fontSize:16,marginTop:100,marginBottom:70}});return t.createElement(L,{style:m.container},t.createElement(x,{style:m.image,source:Le}),t.createElement(k,{style:m.header},"This server is locked!"),t.createElement(k,{style:m.text},"enter passcode to unlock"),t.createElement(H,{style:m.passcode,onSubmitEditing:E=>{if(E.nativeEvent.text==B(a(v,"passcode"),`${Y[5]}${Y[6]}${Y[0]}`)){f(v,e,!1),n();let h="Successfully unlocked!";a(v,"no_auto_refresh")&&(h="Now, long press on server icon to apply unlocking!"),u.open({content:h,source:pe}),T.pop()}else u.open({content:"Incorrect password. Try again.",source:Ie})},secureTextEntry:!0}),t.createElement(k,{style:m.footer},"K2geLocker"))}const l=I.createThemedStyleSheet({container:{backgroundColor:i.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:i.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:i.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:i.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:i.ThemeColorMap.HEADER_PRIMARY},close:{color:i.ThemeColorMap.HEADER_PRIMARY}});return t.createElement(Q.NavigationContainer,null,t.createElement(q.Navigator,{initialRouteName:"K2egeLocker",style:l.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:l.cardStyle,headerStyle:l.header,headerTitleContainerStyle:l.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},t.createElement(q.Screen,{name:"K2geLocker",component:r,options:{headerTitleStyle:{color:"white"},headerLeft:()=>t.createElement(te,{color:l.close.color,title:"Close",onPress:()=>T.pop()}),...G.TransitionPresets.ModalSlideFromBottomIOS}})))};function J(e,n,r){return window.enmity.utilities.findInReactTree(e,n,r)}const _=ie("K2geLocker"),[Te,Me,xe,Ne]=oe(D.byName("MessagesConnected",!1),D.byProps("openLazy","hideActionSheet"),D.byName("GuildsConnected",!1),D.byProps("getLastSelectedGuildId")),Be=c("nsfw_gate_lock"),A=c("img_nitro_star"),R=c("Small"),Fe=c("ic_locked_24px"),Pe=c("ic_full_server_gating_24px"),Ke={...ce,onStart(){this.commands=[Ce];let e,n=this.name;a(this.name,"inv_hijack")===void 0&&f(this.name,"inv_hijack",!0),a(this.name,"no_auto_refresh")===void 0&&f(this.name,"no_auto_refresh",!1),a(this.name,"check_updates")===void 0&&f(this.name,"check_updates",!0),a(this.name,"no_auto_refresh")?e=()=>{}:_.after(xe,"default",(m,E,h)=>{_.after(h,"type",(S,y,d)=>{e=d.handleGuildFolderExpand})});function r(m){e===void 0?u.open({content:"You need to reload Discord first to properly initialize K2geLocker.",source:R}):a("K2geLocker",m)?T.push(De,{guildId:m,fn:e}):b.show({title:"Refreshing server is needed!",body:`Long press on the icon of server you unlocked to refresh and apply unlocking!
If you don't want this behavior, change option in plugin settings.`,confirmText:"OK"})}const l=_.after(L,"render",(m,E,h)=>{const S=J(h,d=>{var s,w,C;return((s=d.props)==null?void 0:s.delayLongPress)==300&&((w=d.props)==null?void 0:w.onGuildSelected)===void 0&&((C=d.props)==null?void 0:C.guild)});if(S){_.before(S.type,"type",(d,s,w)=>{a(this.name,s[0].guild.id)?s[0].onGuildSelected=r:s[0].onGuildSelected=void 0});return}const y=J(h,d=>{var s,w,C;return((s=d.props)==null?void 0:s.guildId)&&((w=d.props)==null?void 0:w.yPos)&&((C=d.props)==null?void 0:C.onClose)});!y||(_.after(y.type,"render",(d,s,w)=>(a(this.name,s[0].guildId)?w.props.rows=[{icon:Pe,text:"Unlock Server",onClick:()=>{r(s[0].guildId)}}]:w.props.rows.unshift({icon:Fe,text:"Lock Server",onClick:()=>{a(this.name,"passcode")===void 0?u.open({content:"Please set passcode in plugin setting before you lock the server!",source:R}):e===void 0?u.open({content:"You need to reload Discord first to properly initialize K2geLocker.",source:R}):a(this.name,s[0].guildId)?u.open({content:"This server is already locked!",source:R}):(f(this.name,s[0].guildId,!0),e(),u.open({content:"Successfully locked!",source:A}))}}),w)),l())});_.instead(Te,"default",(m,E,h)=>{var S;let y=h.apply(m,E),d=(S=y==null?void 0:y.props)==null?void 0:S.guildId;if(d&&a(this.name,d)){const s=I.createThemedStyleSheet({container:{fontFamily:i.Fonts.PRIMARY_SEMIBOLD,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:i.ThemeColorMap.BACKGROUND_PRIMARY},image:{width:120,height:120,padding:5,marginBottom:30},header:{color:i.ThemeColorMap.HEADER_PRIMARY,fontWeight:"bold",fontSize:25},text:{color:i.ThemeColorMap.HEADER_SECONDARY,fontSize:16},passcode:{width:100,height:20,marginTop:30,borderWidth:1,borderColor:i.ThemeColorMap.HEADER_SECONDARY,backgroundColor:i.ThemeColorMap.HEADER_SECONDARY},footer:{color:i.ThemeColorMap.HEADER_SECONDARY,fontSize:16,marginTop:100,marginBottom:70}});return t.createElement(L,{style:s.container},t.createElement(x,{style:s.image,source:Be}),t.createElement(k,{style:s.header},"This server is locked!"),t.createElement(k,{style:s.text},"enter passcode to unlock"),t.createElement(H,{style:s.passcode,onSubmitEditing:w=>{w.nativeEvent.text==B(a(this.name,"passcode"),`${n[0]}${n[1]}${n[4]}`)?(f(this.name,d,!1),u.open({content:"Successfully unlocked!",source:A})):u.open({content:"Incorrect password. Try again.",source:R})},secureTextEntry:!0}),t.createElement(k,{style:s.footer},"K2geLocker"))}else return y}),_.instead(Me,"openLazy",(m,E,h)=>{let S=E[1];if((S.startsWith("instant-invite")||S.startsWith("vanity-url-invite"))&&a(this.name,"inv_hijack")){let y=Ne.getLastSelectedGuildId();a(this.name,y)?b.show({title:"K2geLocker",body:"This server is locked",confirmText:"Ok"}):b.show({title:"K2geLocker",body:"Select an action",confirmText:"Lock the Server",cancelText:"Open invite menu",onConfirm:()=>{a(this.name,"passcode")===void 0?u.open({content:"Please set passcode in plugin setting before you lock the server!",source:R}):(f(this.name,y,!0),u.open({content:"Successfully locked!",source:A}))},onCancel:()=>{h.apply(m,E)}})}else h.apply(m,E)}),a(this.name,"check_updates")&&(a(this.name,"updating")?f(v,"updating",!1):$())},onStop(){this.commands=[],_.unpatchAll()},getSettingsPanel({settings:e}){return t.createElement(ke,{settings:e})}};Z(Ke);
