const b=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const _=window.enmity.modules.common.Toasts,E=window.enmity.modules.common.Dialog;window.enmity.modules.common.Token;const X=window.enmity.modules.common.REST;window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const T=window.enmity.modules.common.Navigation,ye=window.enmity.modules.common.NavigationNative,Z=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme;const M=window.enmity.modules.common.Linking,F=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;function fe(e){window.enmity.plugins.registerPlugin(e)}function be(e){return window.enmity.plugins.getPlugin(e)}const P={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:(e,o)=>window.enmity.modules.filters.byName(e,o),byTypeName:(e,o)=>window.enmity.modules.filters.byTypeName(e,o),byDisplayName:(e,o)=>window.enmity.modules.filters.byDisplayName(e,o)};function _e(e,o){return window.enmity.modules.getModule(e,o)}function ee(...e){return window.enmity.modules.bulk(...e)}window.enmity.modules.common;const{components:r}=window.enmity;r.Alert;const j=r.Button;r.FlatList;const Y=r.Image;r.ImageBackground,r.KeyboardAvoidingView,r.Modal,r.Pressable,r.RefreshControl;const Se=r.ScrollView;r.SectionList,r.StatusBar,r.StyleSheet,r.Switch;const N=r.Text;r.TextInput,r.TouchableHighlight;const pe=r.TouchableOpacity;r.TouchableWithoutFeedback,r.Touchable;const v=r.View;r.VirtualizedList,r.Form,r.FormArrow,r.FormCTA,r.FormCTAButton,r.FormCardSection,r.FormCheckbox,r.FormDivider,r.FormHint,r.FormIcon,r.FormInput,r.FormLabel,r.FormRadio;const h=r.FormRow,te=r.FormSection;r.FormSelect,r.FormSubLabel;const G=r.FormSwitch;r.FormTernaryCheckBox,r.FormText,r.FormTextColors,r.FormTextSizes;function y(e,o,n){window.enmity.settings.set(e,o,n)}function c(e,o,n){return window.enmity.settings.get(e,o,n)}function ve(e){return window.enmity.patcher.create(e)}function a(e){return window.enmity.assets.getIDByName(e)}function oe(e,o,n){return window.enmity.utilities.findInReactTree(e,o,n)}function ke(e=30){return window.enmity.utilities.uuid(e)}var L="K2geLocker",ne="1.3.0",Ee="Lock App / Server with passcode!",Le=[{name:"mafu",id:"519760564755365888"}],Ce="#00fa9a",Ie={name:L,version:ne,description:Ee,authors:Le,color:Ce};function z(e,o){let n="";for(let f=0;f<e.length;f++)n+=String.fromCharCode(e.charCodeAt(f)^o.charCodeAt(f%o.length));return n}const Re=_e(e=>e._dispatcher._actionHandlers._dependencyGraph.nodes),V=Re._dispatcher._actionHandlers._dependencyGraph.nodes;function U(e){let o=Object.keys(V).filter(n=>V[n].name===e);if(o)return V[o[0]].actionHandler}const{native:K}=window.enmity;function re(){K.reload()}K.version,K.build,K.device,K.version;const Te="https://github.com/m4fn3/K2geLocker",Ne="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/manifest.json",Me="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/dist/K2geLocker.js",Pe="https://raw.githubusercontent.com/m4fn3/K2geLocker/master/changelogs.json";function xe(e,o){window.enmity.plugins.installPlugin(Me,()=>{E.show({title:"K2geLocker",body:`Updated from ${e} to ${o}!
Do you want to reload Discord now?`,confirmText:"Yes",cancelText:"Later",onConfirm:()=>re()})})}function ie(e=!1){X.get(Ne).then(o=>{const n=JSON.parse(o.text),f=be(n.name);n.version.localeCompare(f.version,void 0,{numeric:!0})===1?(e||!e&&c(L,"ignored")!=n.version)&&X.get(Pe).then(I=>{const R=JSON.parse(I.text);let u="";R[n.version]&&(u=`

- Changelogs
${R[n.version]}`),E.show({title:"K2geLocker",body:`New version v${n.version} is available!${u}`,confirmText:"Update",cancelText:"Ignore",onConfirm:()=>{y(L,"_updating",!0),xe(f.version,n.version)},onCancel:()=>y(L,"ignored",n.version)})}):e&&E.show({title:"K2geLocker",body:`You are using latest version v${f.version}!`,confirmText:"OK"})}).catch(o=>{o.status===404&&E.show({title:"K2geLocker",body:"Failed to check for updates. Please check GitHub manually.",confirmText:"GitHub",cancelText:"Close",onConfirm:()=>M.openURL(Te)})})}const se=Z.createStackNavigator(),[De]=ee(P.byProps("AppState")),x="Love K2ge3 lol";a("nsfw_gate_lock");const Be=a("img_nitro_star");a("ic_following");const Ke=a("ic_info_24px"),le=a("Small"),Ae=a("ic_arrow_back_24px"),A=F.createThemedStyleSheet({container:{backgroundColor:b.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:b.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,color:b.ThemeColorMap.TEXT_NORMAL},header:{backgroundColor:b.ThemeColorMap.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:b.ThemeColorMap.HEADER_PRIMARY},close:{color:b.ThemeColorMap.HEADER_PRIMARY}});function W({callback:e=null,isSetup:o=!1,showClose:n=!0}){const f=De.useWindowDimensions().width,I=Math.min(f,450);function R(){const u=F.createThemedStyleSheet({container:{flex:1,backgroundColor:b.ThemeColorMap.BACKGROUND_PRIMARY,alignSelf:"center",alignItems:"center",justifyContent:"center",width:I},title:{height:40},titleText:{color:b.ThemeColorMap.HEADER_PRIMARY,fontSize:30},circleBox:{flexDirection:"row",height:130,paddingTop:20},white_circle:{width:20,height:20,borderRadius:10,backgroundColor:"white",marginRight:10},gray_circle:{width:20,height:20,borderRadius:10,backgroundColor:"gray",marginRight:10},numberBox:{flexDirection:"row",flexWrap:"wrap",width:300},number:{width:100,height:70,alignItems:"center",justifyContent:"center"},numberText:{color:b.ThemeColorMap.HEADER_PRIMARY,fontSize:30}});let O=c(L,"passcode"),D=O===void 0?"pass":z(O,`${x[5]}${x[6]}${x[0]}`);const[C,$]=t.useState(""),[B,i]=t.useState("");let l=new Array(D.length).fill(u.gray_circle);const[d,w]=t.useState(l);let S=o?"Enter new passcode":"Enter passcode ";return t.createElement(v,{style:u.container},t.createElement(v,{style:u.title},t.createElement(N,{style:u.titleText},S)),t.createElement(v,{style:u.circleBox},d.map((m,s)=>t.createElement(v,{style:d[s]}))),t.createElement(v,{style:u.numberBox},[1,2,3,4,5,6,7,8,9,"",0,"back"].map((m,s)=>m!==""?t.createElement(pe,{style:u.number,key:s,onPress:()=>{if(typeof m=="number"){let g=B+m.toString();i(g);let p=d;p[g.length-1]=u.white_circle,w(p),g.length===d.length&&setTimeout(()=>{if(!o)g===D?(T.pop(),e()):(i(""),w(l),_.open({content:"Incorrect password. Try again.",source:le}));else if(!C)$(g),i(""),l=new Array(d.length).fill(u.gray_circle),w(l),_.open({content:"Retype new passcode to confirm.",source:Ke});else{if(C===g){let we=z(C,`${x[5]}${x[6]}${x[0]}`);y(L,"passcode",we),_.open({content:"Successfully set new passcode!",source:Be})}else _.open({content:"Passcode didn't match.",source:le});T.pop()}},200)}else{let g=B.slice(0,-1);i(g);let p=d;p[g.length]=u.gray_circle,w(p)}}},typeof m=="number"?t.createElement(N,{style:u.numberText},m):t.createElement(Y,{source:Ae})):t.createElement(v,{style:u.number,key:s}))),t.createElement(v,null,[1].filter(m=>o&&!C).map(m=>t.createElement(j,{onPress:()=>{let s=d.length===4?6:4;l=new Array(s).fill(u.gray_circle),w(l),i("")},title:"Change passcode length"}))))}return t.createElement(ye.NavigationContainer,null,t.createElement(se.Navigator,{initialRouteName:"K2geLocker",style:A.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:A.cardStyle,headerStyle:A.header,headerTitleContainerStyle:A.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},t.createElement(se.Screen,{name:"K2geLocker",component:R,options:{headerTitleStyle:{color:"white"},headerLeft:()=>{if(n)return t.createElement(j,{color:A.close.color,title:"Close",onPress:()=>T.pop()})},...Z.TransitionPresets.ModalSlideFromBottomIOS}})))}const Oe="Love K2ge3 lol",Fe="https://github.com/m4fn3/K2geLocker/blob/master/K2genmity.md";a("img_nitro_star"),a("Small");const Ge=a("img_account_sync_github_white"),Ue=a("img_account_sync_twitter_white"),He=a("ic_message_retry"),$e=a("hub-invite"),je=a("ic_lock"),Ye=a("toast_image_saved"),ze=a("ic_drag_icon_24px"),Ve=a("voice_bar_phone");var We=({settings:e})=>{const o=F.createThemedStyleSheet({container:{flexDirection:"row",justifyContent:"center",alignItems:"center"},image:{width:70,height:70,marginTop:20,marginLeft:20},title:{flexDirection:"column"},name:{fontSize:30,paddingTop:20,paddingLeft:20,paddingRight:30,color:b.ThemeColorMap.HEADER_PRIMARY},author:{fontSize:15,paddingLeft:50,color:b.ThemeColorMap.HEADER_SECONDARY},info:{height:45,paddingTop:3,paddingBottom:3,justifyContent:"center",alignItems:"center"},footer:{color:b.ThemeColorMap.HEADER_SECONDARY,textAlign:"center",paddingTop:10,paddingBottom:20}});return t.createElement(Se,null,t.createElement(v,{style:o.container},t.createElement(Y,{source:{uri:"https://avatars.githubusercontent.com/u/43488869"},style:o.image}),t.createElement(v,{style:o.title},t.createElement(N,{style:o.name},"K2geLocker"),t.createElement(N,{style:o.author},"by mafu"))),t.createElement(te,{title:"SETTINGS"},t.createElement(h,{label:"Setup Passcode",trailing:h.Arrow,leading:t.createElement(h.Icon,{source:ze}),subLabel:"Open password setup modal",onPress:()=>{T.push(W,{isSetup:!0})}}),t.createElement(h,{label:"Reload Discord",trailing:h.Arrow,leading:t.createElement(h.Icon,{source:He}),subLabel:"Reloading is required in order to properly initialize K2geLocker after enabling plugin",onPress:()=>{re()}}),t.createElement(h,{label:"Enable app-wide locking",subLabel:"You can lock entire app with passcode!",leading:t.createElement(h.Icon,{source:je}),trailing:t.createElement(G,{value:e.getBoolean("lock_app",!1),onValueChange:n=>{n&&e.get("passcode")===void 0?(n=!1,E.show({title:"K2geLocker",body:"Please set passcode first!",confirmText:"Ok"})):(e.set("lock_app",n),y(Oe,"_locked",!1))}})}),t.createElement(h,{label:"Use biometrics authentication",subLabel:"**Using K2genmity is required to get Touch/Face ID to work**",leading:t.createElement(h.Icon,{source:Ve}),trailing:t.createElement(G,{value:e.getBoolean("use_bio",!1),onValueChange:n=>{e.get("_isK2genmity")?e.get("_hasBiometricsPerm")?e.set("use_bio",n):(n=!1,E.show({title:"K2geLocker",body:"Please enable biometrics permission by editing Info.plist!",confirmText:"Ok"})):(n=!1,E.show({title:"K2geLocker",body:"Installing K2genmity is required to use biometrics authentication feature!",confirmText:"Check install instructions",cancelText:"Later",onConfirm:()=>{M.openURL(Fe)}}))}})}),t.createElement(h,{label:"Enable invitation menu hijacking",subLabel:"Useful for iPad on which can't long press icon. For servers with inv disabled, use /lock command.",leading:t.createElement(h.Icon,{source:$e}),trailing:t.createElement(G,{value:e.getBoolean("inv_hijack",!0),onValueChange:n=>{e.set("inv_hijack",n)}})}),t.createElement(h,{label:"Check for updates",subLabel:"Whether automatically check or not. You can tap here to check manually too.",leading:t.createElement(h.Icon,{source:Ye}),trailing:t.createElement(G,{value:e.getBoolean("check_updates",!0),onValueChange:n=>{e.set("check_updates",n)}}),onPress:()=>{ie(!0)}})),t.createElement(te,{title:"INFORMATION"},t.createElement(h,{label:"Twitter @m4fn3",style:o.info,trailing:h.Arrow,leading:t.createElement(h.Icon,{source:Ue}),onPress:()=>{M.openURL("https://twitter.com/m4fn3")}}),t.createElement(h,{label:"GitHub (m4fn3)",style:o.info,trailing:h.Arrow,leading:t.createElement(h.Icon,{source:Ge}),onPress:()=>{M.openURL("https://github.com/m4fn3/K2geLocker")}})),t.createElement(N,{style:o.footer},`v${ne}`))},ce;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(ce||(ce={}));var J;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(J||(J={}));var ae;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(ae||(ae={}));var de;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(de||(de={}));var me;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number",e[e.Attachment=11]="Attachment"})(me||(me={}));var ue;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(ue||(ue={}));const Je=a("img_nitro_star"),qe=a("Small"),Qe={id:"lock",name:"lock",displayName:"lock",description:"Lock the server with passcode",displayDescription:"Lock the server with passcode",type:J.Chat,execute:async function(e,o){c(L,"passcode")===void 0?_.open({content:"Please set passcode in plugin setting before you lock the server!",source:qe}):(y(L,o.guild.id,!0),_.open({content:"Successfully locked!",source:Je}))}},H={};M.addEventListener("url",e=>{let o=e.url;o=decodeURIComponent(o.replace("com.hammerandchisel.discord://",""));try{const n=JSON.parse(o);if(n.data===void 0)return;H[n.id]&&(H[n.id](n.data),delete H[n.id])}catch{return}});function ge(e,o=[],n){const f=ke();M.openURL(`com.hammerandchisel.discord://enmity?id=${f}&command=${e}&params=${o.join(",")}`).then(()=>{n&&(H[f]=n)})}const k=ve("K2geLocker"),[Xe,Ze,et,tt,ot]=ee(P.byName("MessagesConnected",!1),P.byProps("openLazy","hideActionSheet"),P.byProps("getLastSelectedGuildId"),P.byProps("getMostRecentSelectedTextChannelId"),P.byProps("_currentDispatchActionType","_subscriptions","_waitQueue")),[nt,rt,he,it]=[U("AppStateStore"),U("DeveloperOptionsStore"),U("ModalDeprecatedStore"),U("GatewayConnectionStore")],st=a("nsfw_gate_lock"),q=a("img_nitro_star"),Q=a("Small"),lt=a("ic_locked_24px"),ct=a("ic_full_server_gating_24px");function at(e,o,n=!1){(n||c("K2geLocker",e)===void 0)&&y("K2geLocker",e,o)}const dt={...Ie,onStart(){this.commands=[Qe];let e=this.name;[["inv_hijack",!0],["check_updates",!0],["lock_app",!1],["use_bio",!1],["_isK2genmity",!1,!0],["_hasBiometricsPerm",!1,!0]].forEach(i=>{at(...i)});function o(i){let l=tt.getMostRecentSelectedTextChannelId(i);ot.dispatch({type:"CHANNEL_SELECT",guildId:i,channelId:l,messageId:void 0,jumpType:"ANIMATED",preserveDrawerState:!1,source:void 0})}function n(i,l){c(e,"use_bio")&&setTimeout(()=>{ge("K2geLocker",["authentication"],d=>{d=="success"&&(T.pop(),i())})},l)}function f(i){const l=()=>{y(e,i,!1),o(i),_.open({content:"Successfully unlocked!",source:q})};T.push(W,{callback:l}),n(l,300)}const I=()=>{y(e,"_locked",!1)};function R(){T.push(W,{callback:I,showClose:!1})}c(e,"lock_app")&&c(e,"passcode")!==void 0&&(R(),n(I,100));let u=!1;k.before(nt,"APP_STATE_UPDATE",(i,l,d)=>{let w=l[0].state;c(e,"lock_app")&&(c(e,"passcode")===void 0?y(e,"lock_app",!1):w=="background"?(c(e,"_locked")||(R(),y(e,"_locked",!0)),u=!0):w=="active"&&c(e,"_locked")&&u&&(u=!1,n(I,100)))});const O=k.after(v,"render",(i,l,d)=>{const w=oe(d,m=>{var s,g,p;return((s=m.props)==null?void 0:s.delayLongPress)==300&&((g=m.props)==null?void 0:g.onGuildSelected)===void 0&&((p=m.props)==null?void 0:p.guild)});if(w){k.before(w.type,"type",(m,s,g)=>{c(e,s[0].guild.id)?c(e,"passcode")===void 0?(y(e,s[0].guild.id,void 0),s[0].onGuildSelected=void 0):s[0].onGuildSelected=f:s[0].onGuildSelected=void 0});return}const S=oe(d,m=>{var s,g,p;return((s=m.props)==null?void 0:s.guildId)&&((g=m.props)==null?void 0:g.yPos)&&((p=m.props)==null?void 0:p.onClose)});!S||(k.after(S.type,"render",(m,s,g)=>(c(e,s[0].guildId)?g.props.rows=[{icon:ct,text:"Unlock Server",onClick:()=>{f(s[0].guildId)}}]:g.props.rows.unshift({icon:lt,text:"Lock Server",onClick:()=>{c(e,"passcode")===void 0?_.open({content:"Please set passcode in plugin setting before you lock the server!",source:Q}):c(e,s[0].guildId)?_.open({content:"This server is already locked!",source:Q}):(y(e,s[0].guildId,!0),_.open({content:"Successfully locked!",source:q}))}}),g)),O())});k.instead(Xe,"default",(i,l,d)=>{var w;let S=d.apply(i,l),m=(w=S==null?void 0:S.props)==null?void 0:w.guildId;if(m&&c(e,m)){const s=F.createThemedStyleSheet({container:{fontFamily:b.Fonts.PRIMARY_SEMIBOLD,flex:1,alignItems:"center",justifyContent:"center",backgroundColor:b.ThemeColorMap.BACKGROUND_PRIMARY},image:{width:120,height:120,padding:5,marginBottom:30},header:{color:b.ThemeColorMap.HEADER_PRIMARY,fontWeight:"bold",fontSize:25,marginBottom:30},button:{fontSize:30},footer:{color:b.ThemeColorMap.HEADER_SECONDARY,fontSize:16,marginTop:80,marginBottom:70}});return t.createElement(v,{style:s.container},t.createElement(Y,{style:s.image,source:st}),t.createElement(N,{style:s.header},"This server is locked!"),t.createElement(j,{style:s.button,onPress:()=>f(m),title:"Unlock"}),t.createElement(N,{style:s.footer},"K2geLocker"))}else return S}),k.instead(Ze,"openLazy",(i,l,d)=>{let w=l[1];if((w.startsWith("instant-invite")||w.startsWith("vanity-url-invite"))&&c(e,"inv_hijack")){let S=et.getLastSelectedGuildId();c(e,S)?E.show({title:"K2geLocker",body:"This server is locked",confirmText:"Ok"}):E.show({title:"K2geLocker",body:"Select an action",confirmText:"Lock the Server",cancelText:"Open invite menu",onConfirm:()=>{c(e,"passcode")===void 0?_.open({content:"Please set passcode in plugin setting before you lock the server!",source:Q}):(y(e,S,!0),_.open({content:"Successfully locked!",source:q}))},onCancel:()=>{d.apply(i,l)}})}else d.apply(i,l)}),k.before(rt,"LOGOUT",(i,l,d)=>{E.show({title:"K2geLocker",body:`Automatically disabled itself to prevent app from causing weird problems!
Please enable plugin manually after you re-login to the account.`,confirmText:"See you again!"}),this.commands=[],k.unpatchAll(),window.enmity.plugins.disablePlugin("K2geLocker")});let D=!1,C=[];k.before(it,"PUSH_NOTIFICATION_CLICK",(i,l,d)=>{D=!0,C=[]});const $=["MODAL_POP_ALL","CHANGE_LOG_CLOSE","CHANNEL_SETTINGS_CLOSE","GUILD_SETTINGS_CLOSE","EMAIL_VERIFICATION_MODAL_CLOSE","NOTIFICATION_SETTINGS_MODAL_CLOSE","SEARCH_MODAL_CLOSE","USER_SETTINGS_MODAL_CLOSE","MENTION_MODAL_CLOSE"];Object.keys(he).forEach(i=>{$.includes(i)&&k.instead(he,i,(l,d,w)=>{D&&!Object.keys(C).includes(i)?C[i]=!0:w.apply(l,d)})}),ge("K2geLocker",["check"],i=>{y(e,"_isK2genmity",!0),i=="yes"&&y(e,"_hasBiometricsPerm",!0)}),c(e,"check_updates")&&(c(e,"_updating")?y(L,"_updating",!1):ie());let B=c(L,"passcode");if(B!==void 0){let i=z(B,`${e[0]}${e[1]}${e[4]}`);isNaN(i)&&y(e,"passcode",void 0)}},onStop(){this.commands=[],k.unpatchAll()},getSettingsPanel({settings:e}){return t.createElement(We,{settings:e})}};fe(dt);
